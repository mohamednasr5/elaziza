<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª - Ø§Ù„Ø¹Ø²ÙŠØ²Ø©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Ø§Ù„Ø®Ø· Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù…Ø¸Ù‡Ø± Ø¬Ù…ÙŠÙ„ -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    /* CSS Ù…Ø±ØªØ¨: Ù†Ø³Ù‚ ÙˆÙˆØ¶ÙˆØ­ */
    *{ margin:0; padding:0; box-sizing:border-box; font-family:"Cairo",sans-serif; }
    body{
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh; display:flex; justify-content:center; align-items:center;
      padding:20px; color:#fff;
    }
    .hidden{ display:none !important; }

    .container{
      width:100%; max-width:800px; background:#fff; color:#222;
      padding:35px; border-radius:20px;
      box-shadow:0 20px 60px rgba(0,0,0,.3);
      animation:fade .5s ease;
    }
    @keyframes fade{
      from{opacity:0; transform:translateY(20px);}
      to{opacity:1; transform:translateY(0);}
    }

    h2{
      text-align:center; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      font-size:2.2em; font-weight:900;
    }

    .committee-info{
      text-align:center; margin-top:12px; margin-bottom:25px;
      background:linear-gradient(135deg,#f5f7ff 0%,#eff2ff 100%);
      padding:14px; border-radius:12px; border-left:4px solid #667eea;
    }
    .committee-name{ font-size:1.1em; font-weight:700; color:#667eea; margin-bottom:4px; }
    .committee-address{ font-size:0.9em; color:#666; font-weight:500; }

    label{ font-weight:700; color:#333; margin-top:18px; display:block; }
    input[type=text]{
      width:100%; padding:13px 14px; border-radius:12px;
      border:2px solid #e0e7ff; background:#f8f9ff; font-size:1em; transition:all 0.3s;
    }
    input[type=text]:focus{
      outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,0.1);
    }

    .candidate-list{
      margin-top:14px; background:#f8f9ff; border:2px solid #e0e7ff;
      border-radius:14px; max-height:350px; overflow-y:auto; padding:12px;
    }
    .candidate-item{
      background:#fff; border:1px solid #e8ecff; padding:12px;
      border-radius:12px; margin-bottom:10px;
      display:flex; justify-content:space-between; align-items:center;
      transition:all 0.3s; cursor:pointer; border-left:4px solid #667eea;
    }
    .candidate-item:hover{ 
      background:linear-gradient(135deg,#f5f7ff 0%,#eff2ff 100%);
      border-color:#667eea; box-shadow:0 4px 12px rgba(102,126,234,0.2);
    }
    .candidate-item.selected{
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      color:#fff; border-left-color:#fff;
    }
    .c-left{ display:flex; align-items:center; gap:12px; flex:1; }
    .num-circle{
      width:32px; height:32px; border-radius:50%;
      background:#667eea; color:#fff;
      display:flex; align-items:center; justify-content:center;
      font-size:0.95em; font-weight:900;
    }
    .candidate-item.selected .num-circle{
      background:#fff; color:#667eea;
    }
    .c-name{ font-weight:700; }
    .c-right{ display:flex; align-items:center; gap:10px; }
    .c-icon{ font-size:1.8em; }
    input[type="checkbox"]{ width:20px; height:20px; cursor:pointer; accent-color:#667eea; }

    .sec-box{
      margin-top:18px; background:linear-gradient(135deg,#f5f7ff 0%,#eff2ff 100%);
      border:2px solid #e0e7ff; border-radius:12px; padding:16px;
    }
    .sec-title{ font-weight:700; color:#667eea; display:block; margin-bottom:12px; font-size:1.05em; }
    .radio-group{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .radio-item{
      display:flex; align-items:center; gap:8px; cursor:pointer;
      padding:10px; background:#fff; border-radius:10px;
      border:2px solid #e0e7ff; transition:all 0.3s;
    }
    .radio-item:hover{ border-color:#667eea; background:#f8f9ff; }
    .radio-item input[type="radio"]{ width:18px; height:18px; cursor:pointer; }
    .radio-item.selected{
      background:#667eea; color:#fff; border-color:#667eea;
    }
    .radio-item.selected input[type="radio"]{ accent-color:#fff; }

    .btn-row{ display:flex; gap:12px; margin-top:25px; }
    button{
      flex:1; padding:13px; border:none; border-radius:12px;
      cursor:pointer; font-weight:700; font-size:1.05em; transition:all 0.3s;
    }
    .btn-primary{ background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }
    .btn-primary:hover{ transform:translateY(-2px); }
    .btn-reset{ background:#e0e7ff; color:#667eea; font-weight:700; }
    .btn-reset:hover{ background:#d3ddff; }
    .btn-logout{ background:#ffebee; color:#c62828; font-weight:700; }
    .btn-logout:hover{ background:#ffcdd2; }

    .msg-warn, .msg-confirm{
      display:none; margin-top:15px; padding:13px; border-radius:10px;
      text-align:center; font-weight:700; animation:slideDown 0.3s ease;
    }
    @keyframes slideDown{
      from{opacity:0; transform:translateY(-10px);}
      to{opacity:1; transform:translateY(0);}
    }
    .msg-warn{ background:#ffebee; color:#c62828; border-left:4px solid #c62828; }
    .msg-confirm{ background:#e8f5e9; color:#2e7d32; border-left:4px solid #2e7d32; }

    #bubble{
      position:fixed; bottom:25px; right:25px;
      background:#fff; color:#222;
      padding:16px; border-radius:12px;
      box-shadow:0 8px 24px rgba(0,0,0,.3);
      font-size:1em; font-weight:700;
      display:none; width:320px; max-width:calc(100vw - 50px);
      animation:slide .4s ease; border-left:4px solid #667eea;
      z-index:99999;
    }

    #bubble.active{
      display:flex;
      align-items:flex-start;
      gap:12px;
    }

    #bubble-icon{
      font-size:1.6em;
      min-width:28px;
      text-align:center;
      margin-top:2px;
    }

    #bubble-content{
      flex:1;
      line-height:1.5;
    }

    #bubble-close{
      background:none;
      border:none;
      font-size:1.4em;
      color:#999;
      cursor:pointer;
      padding:0;
      min-width:28px;
      text-align:center;
      transition:all 0.3s;
      opacity:0.6;
    }

    #bubble-close:hover{
      opacity:1;
      color:#667eea;
    }

    @keyframes slide{
      from{transform:translateY(20px);opacity:0;}
      to{transform:translateY(0);opacity:1;}
    }

    .sig{text-align:left; margin-top:25px; color:#999; font-style:italic; font-size:0.85em;}

    @media(max-width:600px){
      .container{ padding:20px; }
      h2{ font-size:1.6em; }
      .radio-group{ grid-template-columns:1fr; }
      .candidate-list{ max-height:400px; }
    }
  </style>
</head>
<body>
<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© -->
<div id="bubble">
  <div id="bubble-icon">ğŸ’¬</div>
  <div id="bubble-content"></div>
  <button id="bubble-close" onclick="closeBubble()">Ã—</button>
</div>

<!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
<div class="container" id="main-container">
  <h2 id="welcome-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª - Ø§Ù„Ø¹Ø²ÙŠØ²Ø©</h2>
  <div class="committee-info">
    <div class="committee-name" id="committee-name-display"></div>
    <div class="committee-address" id="committee-address-display"></div>
  </div>

  <form id="vote-form" autocomplete="off">
    <label for="voter-name">Ø§Ø³Ù… Ø§Ù„Ù†Ø§Ø®Ø¨:</label>
    <input type="text" id="voter-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù†Ø§Ø®Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">

    <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø´Ø­ (Ø­ØªÙ‰ 2):</label>
    <div class="candidate-list" id="candidate-list"></div>

    <div class="sec-box">
      <span class="sec-title">Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª:</span>
      <div class="radio-group">
        <label class="radio-item">
          <input type="radio" name="vvalid" value="ØµØ­ÙŠØ­">
          <span>âœ“ ØµØ­ÙŠØ­</span>
        </label>
        <label class="radio-item">
          <input type="radio" name="vvalid" value="Ø¨Ø§Ø·Ù„">
          <span>âœ— Ø¨Ø§Ø·Ù„</span>
        </label>
      </div>
    </div>

    <div class="btn-row">
      <button type="submit" class="btn-primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</button>
      <button type="reset" class="btn-reset">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
      <button type="button" class="btn-logout" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="msg-warn" class="msg-warn"></div>
    <div id="msg-confirm" class="msg-confirm"></div>
  </form>

  <div class="sig">
    ØªÙ… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø¨ÙˆØ§Ø³Ø·Ø© 
    <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank" 
       style="color:#1e3c72; font-weight:900; text-decoration:underline;">
       Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯
    </a>
  </div>
</div>

<!-- Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª Ù…ÙˆØ¯ÙŠÙˆÙ„: Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„ØªØµÙˆÙŠØª ÙˆØ§Ù„ÙÙ„Ø§Ø´ ÙˆØ§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆÙ‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
<script type="module">
// Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ÙˆØ±Ø¨Ø·Ù‡
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-messaging.js";

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª (ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ø°Ø§ ØºÙŠØ±Øª Ø§Ù„Ù…Ø´Ø±ÙˆØ¹)
const firebaseConfig = {
  apiKey: "AIzaSyCxxXV_6CEo1fTp3rRbfwfYbe7WH0Cyg38",
  authDomain: "elahmadiya.firebaseapp.com",
  databaseURL: "https://elahmadiya-default-rtdb.firebaseio.com",
  projectId: "elahmadiya",
  storageBucket: "elahmadiya.firebasestorage.app",
  messagingSenderId: "594580767620",
  appId: "1:594580767620:web:f5be3b87d4c704854e53d1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const messaging = getMessaging(app);

// Ù…ÙØªØ§Ø­ VAPID Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„ÙˆÙŠØ¨ (Ø¹Ø¯Ù„ Ù…Ù† Firebase Console Ø­Ø³Ø¨ Ù…Ø´Ø±ÙˆØ¹Ùƒ)
const VAPID_KEY = "BBc4i5tl6yb0Z584Vb5J4n-zHzSEMRZzW-Bh63PFkyJ5nkjx4-3qb3c_gn4BpwnN1ewUD47tx5UWedR06ulmW_o";

let committeeNumber = 0;
let committeeName = "";
let closedNotifications = new Set();

// Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†ÙˆØ¹ Ø§Ù„Ù„Ø¬Ù†Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
const urlParams = new URLSearchParams(window.location.search);
const committeeType = urlParams.get('type');

// Ø­Ù…Ø§ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¯Ø®Ù„ Ø¨Ø§Ù„Ø±Ø§Ø¨Ø· (Ø±Ø¬Ø§Ù„/Ù†Ø³Ø§Ø¡ ÙÙ‚Ø·)
if(!committeeType || (committeeType !== 'women' && committeeType !== 'men')){
  window.location.href = 'index.html'; // ÙŠÙ…ÙƒÙ†Ùƒ ØªØ®ØµÙŠØµ ØµÙØ­Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„
}

// ØªØ¹ÙŠÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¬Ù†Ø© ÙˆØ§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
if(committeeType === 'women'){
  committeeNumber = 24;
  committeeName = "Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© Ù„Ø¬Ù†Ø© Ø§Ù„Ù†Ø³Ø§Ø¡";
} else {
  committeeNumber = 25;
  committeeName = "Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© Ù„Ø¬Ù†Ø© Ø§Ù„Ø±Ø¬Ø§Ù„";
}
document.getElementById("welcome-title").textContent = "Ø§Ù„Ù„Ø¬Ù†Ø© " + committeeNumber;
document.getElementById("committee-name-display").textContent = committeeName;
document.getElementById("committee-address-display").textContent = "Ù…Ø¯Ø±Ø³Ø© Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©";

// Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØªØ³Ø¬ÙŠÙ„ FCM Token ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
async function requestNotificationPermission() {
  try {
    const permission = await Notification.requestPermission();
    if (permission === 'granted') {
      const currentToken = await getToken(messaging, { vapidKey: VAPID_KEY });
      if (currentToken) {
        saveTokenToDatabase(currentToken);
      }
    }
  } catch (error) {
    // ÙŠÙ…ÙƒÙ† Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡ Ù„Ùˆ Ø§Ø­ØªØ¬Øª
  }
}
// Ø­ÙØ¸ Ø±Ù…Ø² Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
function saveTokenToDatabase(token) {
  const tokenRef = ref(db, `fcm_tokens/${committeeNumber}/${Date.now()}`);
  set(tokenRef, {
    token: token,
    committee: committeeNumber,
    timestamp: Date.now()
  });
}

// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø­ÙŠØ©
onMessage(messaging, (payload) => {
  const notificationTitle = payload.notification?.title || 'Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯';
  const notificationBody = payload.notification?.body || 'Ù„Ø¯ÙŠÙƒ Ø¥Ø´Ø¹Ø§Ø± Ø¬Ø¯ÙŠØ¯';
  showFloatingNotification(notificationBody, notificationTitle);
});

// ØªØ­Ù…ÙŠÙ„ ÙˆØ­ÙØ¸ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªÙ… Ø¥ØºÙ„Ø§Ù‚Ù‡Ø§
function loadClosedNotifications() {
  const stored = localStorage.getItem("closedNotifications_aziza");
  if (stored) {
    try {
      closedNotifications = new Set(JSON.parse(stored));
    } catch (e) {
      closedNotifications = new Set();
    }
  }
}
function saveClosedNotifications() {
  try {
    localStorage.setItem(
      "closedNotifications_aziza",
      JSON.stringify(Array.from(closedNotifications))
    );
  } catch (e) {}
}
loadClosedNotifications();

// Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø©
function setupNotificationListeners(committee){
  try {
    const allNotificationsRef = ref(db, "notifications/all");
    let lastAllTimestamp = 0;
    onValue(allNotificationsRef, (snapshot) => {
      const data = snapshot.val();
      if(data && typeof data === 'object'){
        Object.entries(data).forEach(([key, notif]) => {
          if(notif && notif.message && notif.timestamp && notif.timestamp > lastAllTimestamp){
            lastAllTimestamp = notif.timestamp;
            showFloatingNotification(notif.message, "ğŸ“¢ Ø¥Ø´Ø¹Ø§Ø± Ø¹Ø§Ù…");
          }
        });
      }
    });
    if(committee > 0){
      const committeeNotificationsRef = ref(db, `notifications/committee_${committee}`);
      let lastCommitteeTimestamp = 0;
      onValue(committeeNotificationsRef, (snapshot) => {
        const data = snapshot.val();
        if(data && typeof data === 'object'){
          Object.entries(data).forEach(([key, notif]) => {
            if(notif && notif.message && notif.timestamp && notif.timestamp > lastCommitteeTimestamp){
              lastCommitteeTimestamp = notif.timestamp;
              showFloatingNotification(notif.message, "ğŸ“© Ø¥Ø´Ø¹Ø§Ø± Ù„Ø¬Ù†ØªÙƒ");
            }
          });
        }
      });
    }
  } catch(e) {}
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù…Ø©
function showFloatingNotification(msg, type){
  const bubble = document.getElementById("bubble");
  const content = document.getElementById("bubble-content");
  const icon = document.getElementById("bubble-icon");
  const notificationId = type + "_" + Date.now();
  bubble.dataset.notificationId = notificationId;
  if(closedNotifications.has(notificationId)){ return; }
  content.textContent = msg;
  if(type.includes("Ø¹Ø§Ù…") || type.includes("ğŸ“¢")){
    bubble.style.borderLeft = "4px solid #667eea";
    icon.textContent = "ğŸ“¢";
  } else if(type.includes("Ù„Ø¬Ù†ØªÙƒ") || type.includes("ğŸ“©")){
    bubble.style.borderLeft = "4px solid #11998e";
    icon.textContent = "ğŸ“©";
  } else {
    bubble.style.borderLeft = "4px solid #ffcc00";
    icon.textContent = "ğŸ’¬";
  }
  bubble.classList.add("active");
  setTimeout(() => { if(bubble.classList.contains("active")){ closeBubble(); } }, 10000);
}
window.closeBubble = function(){
  const bubble = document.getElementById("bubble");
  const notificationId = bubble.dataset.notificationId;
  if(notificationId){
    closedNotifications.add(notificationId);
    saveClosedNotifications();
  }
  bubble.classList.remove("active");
};
// Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ ÙŠØ¹ÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
window.logout = function(){
  window.location.href = 'index.html';
};

// Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
setupNotificationListeners(committeeNumber);
// Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
requestNotificationPermission();

// --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† ---
const candidates = [
  ["1","Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø¯Ù‡","ğŸ‘‘"],
  ["2","Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙ…Ø§Ù†Ù‰","ğŸ"],
  ["3","Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯Ù‰","ğŸ¦"],
  ["4","Ø¹Ø§Ø¯Ù„ Ø§Ù„Ø¬ÙŠØ§Ø±","ğŸ¦…"],
  ["5","Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø³Ù…Ø±Ù‡","ğŸ’£"],
  ["6","ÙˆÙ„ÙŠØ¯ ØªÙŠØ³ÙŠØ± Ø§Ù„Ø§Ù…ÙŠØ±","ğŸŠ"],
  ["7","ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹ÙŠØ³ÙˆÙ‰","ğŸŒ€"],
  ["8","Ø§Ù„Ø¨Ø¯ÙˆÙ‰ Ø¬Ù…ÙŠØ²","ğŸ‹"],
  ["9","Ø§Ø­Ù…Ø¯ Ø§Ù„Ø±ÙŠØ³","ğŸ¦‚"],
  ["10","Ø£Ø­Ù…Ø¯ Ø¹ÙˆÙ","âœ‹"],
  ["11","Ø­Ø³Ù† Ø§Ù„Ù…Ù„Ù‡Ø§Ø·","ğŸŒ¿"],
  ["12","Ø¹Ù…Ø±Ùˆ Ù…Ø­Ù…Ø¯ Ø¨Ø­ÙŠØ±Ù‰","ğŸšŒ"],
  ["13","Ø§Ù„Ø³ÙŠØ¯ Ø·Ù…Ø§Ù†","ğŸ”«"],
  ["14","Ù…Ø­Ù…Ø¯ Ø¯Ù†Ø¯Ù†","ğŸš"],
  ["15","Ù…Ø¬Ø¯Ù‰ Ø§Ù„Ø£Ù…ÙŠØ±","ğŸ–Š"]
];
// Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†
const listBox = document.getElementById("candidate-list");
candidates.forEach((c,idx) => {
  const item = document.createElement("div");
  item.className = "candidate-item";
  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.value = c[1];
  checkbox.className = "candidate-checkbox";
  item.innerHTML = `<div class="c-left"><div class="num-circle">${c[0]}</div><div class="c-name">${c[1]}</div></div><div class="c-right"><span class="c-icon">${c[2]}</span></div>`;
  item.appendChild(checkbox);
  item.addEventListener("click", (e) => {
    if(e.target !== checkbox) checkbox.checked = !checkbox.checked;
    checkLimit();
    updateStyle();
  });
  checkbox.addEventListener("change", () => {
    checkLimit();
    updateStyle();
  });
  listBox.appendChild(item);
});
function updateStyle(){
  document.querySelectorAll(".candidate-item").forEach((item) => {
    if(item.querySelector("input[type='checkbox']").checked) 
      item.classList.add("selected");
    else 
      item.classList.remove("selected");
  });
}
// ØªØ­Ø¯ÙŠØ¯ Ø£Ù‚ØµÙ‰ Ø¹Ø¯Ø¯ ÙŠÙÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø±Ù‡ (Ù…Ø±Ø´Ø­ÙŠÙ†)
function checkLimit(){
  const sel = document.querySelectorAll('.candidate-checkbox:checked');
  if(sel.length > 2){
    sel[sel.length - 1].checked = false;
    showWarn("ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø´Ø­ÙŠÙ† ÙÙ‚Ø·");
    updateStyle();
  }
}
function showWarn(msg){
  const el = document.getElementById("msg-warn");
  el.textContent = msg;
  el.style.display = "block";
  setTimeout(() => el.style.display = "none", 2500);
}
function showConfirm(msg){
  const el = document.getElementById("msg-confirm");
  el.textContent = msg;
  el.style.display = "block";
  setTimeout(() => el.style.display = "none", 3000);
}
// ØªØ®ØµÙŠØµ Ø´ÙƒÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ù„Ù„Ø±Ø§Ø¯ÙŠÙˆ
document.querySelectorAll("input[type='radio']").forEach(radio => {
  radio.addEventListener("change", function(){
    document.querySelectorAll(".radio-item").forEach(item => item.classList.remove("selected"));
    this.closest(".radio-item").classList.add("selected");
  });
});
// Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙˆØ±Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„
document.getElementById("vote-form").addEventListener("submit", function(e){
  e.preventDefault();
  let name = document.getElementById("voter-name").value.trim();
  if(!name) name = "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
  const sel = Array.from(document.querySelectorAll('.candidate-checkbox:checked')).map(v => v.value);
  const val = document.querySelector('input[name="vvalid"]:checked');
  if(sel.length < 1) return showWarn("Ø§Ø®ØªØ± Ù…Ø±Ø´Ø­ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
  if(!val) return showWarn("Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª");
  const voteKey = Date.now();
  const votePath = `votes/aziza/${voteKey}`;
  const voteRef = ref(db, votePath);
  set(voteRef, {
    name: name,
    selected: sel,
    vote_validity: val.value,
    committee: committeeNumber,
    timestamp: voteKey
  }).then(() => {
    showConfirm("âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
    document.getElementById("vote-form").reset();
    updateStyle();
    document.querySelectorAll(".radio-item").forEach(item => item.classList.remove("selected"));
  }).catch(err => {
    showWarn("âŒ Ø®Ø·Ø£: " + err.message);
  });
});
</script>
</body>
</html>
