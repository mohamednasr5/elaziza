<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>تسجيل الناخبين</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.20.0/firebase-database.js"></script>
</head>
<body>
  <div class="container">
    <h2>تسجيل الدخول</h2>
    <input type="password" id="password" placeholder="كلمة المرور..." />
    <button onclick="login()">دخول</button>
    <div id="login-error" class="alert" style="display:none"></div>

    <div id="vote-form" style="display:none">
      <h2>تسجيل التصويت</h2>
      <input type="text" id="voter-name" placeholder="اسم الناخب" />
      <select multiple id="candidates"></select>
      <select id="status">
        <option value="صحيح">✓ صحيح</option>
        <option value="باطل">✗ باطل</option>
      </select>
      <button onclick="submitVote()">تسجيل التصويت</button>
      <button onclick="resetForm()">إعادة ضبط</button>
      <div id="vote-success" class="toast" style="display:none"></div>
    </div>
    <hr>
    <footer>تم البرمجة بواسطة<br>المهندس محمد حماد</footer>
  </div>
<script>
// إعدادات Firebase (يجب تعديلها حسب مشروعك)
const firebaseConfig = { /* بيانات مشروعك هنا */ };
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const PASSWORD = "12345"; // كلمة مرور للعرض فقط

function login() {
  const pass = document.getElementById('password').value;
  if (pass === PASSWORD) {
    document.getElementById('vote-form').style.display = '';
    document.getElementById('login-error').style.display = 'none';
  } else {
    document.getElementById('login-error').textContent = 'كلمة السر غير صحيحة';
    document.getElementById('login-error').style.display = '';
  }
}

// تحميل أسماء المرشحين تلقائيًا من قاعدة اللجنة
db.ref("candidates").on("value", snap => {
  const list = document.getElementById('candidates');
  list.innerHTML = '';
  snap.forEach(item => {
    const opt = document.createElement('option');
    opt.value = item.val();
    opt.textContent = item.val();
    list.appendChild(opt);
  });
});

function submitVote() {
  const name = document.getElementById('voter-name').value;
  const selected = Array.from(document.getElementById('candidates').selectedOptions).map(o=>o.value);
  const status = document.getElementById('status').value;
  if (!name || selected.length === 0) {
    showMessage('vote-success', 'يرجى إدخال الاسم واختيار مرشح واحد على الأقل');
    return;
  }
  db.ref("votes").push({name, selected, status, time: Date.now()});
  showMessage('vote-success', 'تم تسجيل التصويت بنجاح');
  resetForm();
}

function resetForm() {
  document.getElementById('voter-name').value = '';
  Array.from(document.getElementById('candidates').options).forEach(option => option.selected = false);
  document.getElementById('status').value = 'صحيح';
}

function showMessage(id, msg){
  const el = document.getElementById(id);
  el.textContent = msg;
  el.style.display = '';
  setTimeout(()=> { el.style.display = 'none'; }, 2500);
}
</script>
</body>
</html>
