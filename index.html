<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
*{ margin:0; padding:0; box-sizing:border-box; font-family:"Cairo",sans-serif; }
body{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  min-height:100vh; display:flex; justify-content:center; align-items:center;
  padding:20px; color:#fff;
}
.hidden{ display:none !important; }

#password-modal{
  position:fixed; inset:0; background:rgba(0,0,0,.7); backdrop-filter:blur(10px);
  display:flex; justify-content:center; align-items:center; z-index:9999;
}
.pass-box{
  width:90%; max-width:400px; background:#fff; color:#222;
  padding:35px 30px; border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.4);
  animation:pop .4s ease; text-align:center;
}
@keyframes pop{ from{transform:scale(.6);opacity:.2} to{transform:scale(1);opacity:1} }

.pass-title{ font-size:1.6em; font-weight:900; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent; }
.pass-row{ position:relative; margin-top:20px; }
.pass-input{
  width:100%; padding:14px 16px; text-align:center;
  border-radius:12px; border:2px solid #e0e7ff; background:#f8f9ff; font-size:1.1em;
  transition:all 0.3s;
}
.pass-input:focus{
  outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,0.1);
}
.pass-toggle{
  position:absolute; left:15px; top:50%; transform:translateY(-50%);
  font-size:1.3em; color:#667eea; cursor:pointer; opacity:0.6;
  transition:all 0.3s;
}
.pass-btn{
  margin-top:20px; width:100%; padding:13px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color:#fff; border:none; border-radius:12px; font-size:1.05em;
  font-weight:bold; cursor:pointer; transition:all 0.3s;
}
.pass-btn:hover{ transform:translateY(-2px); }
.pass-err{ margin-top:12px; color:#c62828; font-weight:bold; display:none; font-size:0.95em; }

.container{
  width:100%; max-width:800px; background:#fff; color:#222;
  padding:35px; border-radius:20px;
  box-shadow:0 20px 60px rgba(0,0,0,.3);
  animation:fade .5s ease;
}
@keyframes fade{
  from{opacity:0; transform:translateY(20px);}
  to{opacity:1; transform:translateY(0);}
}

h2{
  text-align:center; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  font-size:2.2em; font-weight:900;
}
.committee-info{
  text-align:center; margin-top:12px; margin-bottom:25px;
  background:linear-gradient(135deg,#f5f7ff 0%,#eff2ff 100%);
  padding:14px; border-radius:12px; border-left:4px solid #667eea;
}
.committee-name{
  font-size:1.1em; font-weight:700; color:#667eea; margin-bottom:4px;
}
.committee-address{
  font-size:0.9em; color:#666; font-weight:500;
}
.subtitle{text-align:center; color:#999; margin-top:8px; margin-bottom:25px; font-size:0.95em;}

label{ font-weight:700; color:#333; margin-top:18px; display:block; }
input[type=text]{
  width:100%; padding:13px 14px; border-radius:12px;
  border:2px solid #e0e7ff; background:#f8f9ff; font-size:1em; transition:all 0.3s;
}
input[type=text]:focus{
  outline:none; border-color:#667eea; box-shadow:0 0 0 3px rgba(102,126,234,0.1);
}

.candidate-list{
  margin-top:14px; background:#f8f9ff; border:2px solid #e0e7ff;
  border-radius:14px; max-height:350px; overflow-y:auto; padding:12px;
}
.candidate-item{
  background:#fff; border:1px solid #e8ecff; padding:12px;
  border-radius:12px; margin-bottom:10px;
  display:flex; justify-content:space-between; align-items:center;
  transition:all 0.3s; cursor:pointer; border-left:4px solid #667eea;
}
.candidate-item:hover{ 
  background:linear-gradient(135deg,#f5f7ff 0%,#eff2ff 100%);
  border-color:#667eea; box-shadow:0 4px 12px rgba(102,126,234,0.2);
}
.candidate-item.selected{
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color:#fff; border-left-color:#fff;
}
.c-left{ display:flex; align-items:center; gap:12px; flex:1; }
.num-circle{
  width:32px; height:32px; border-radius:50%;
  background:#667eea; color:#fff;
  display:flex; align-items:center; justify-content:center;
  font-size:0.95em; font-weight:900;
}
.candidate-item.selected .num-circle{
  background:#fff; color:#667eea;
}
.c-name{ font-weight:700; }
.c-right{ display:flex; align-items:center; gap:10px; }
.c-icon{ font-size:1.8em; }
input[type="checkbox"]{ width:20px; height:20px; cursor:pointer; accent-color:#667eea; }

.sec-box{
  margin-top:18px; background:linear-gradient(135deg,#f5f7ff 0%,#eff2ff 100%);
  border:2px solid #e0e7ff; border-radius:12px; padding:16px;
}
.sec-title{ font-weight:700; color:#667eea; display:block; margin-bottom:12px; font-size:1.05em; }
.radio-group{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
.radio-item{
  display:flex; align-items:center; gap:8px; cursor:pointer;
  padding:10px; background:#fff; border-radius:10px;
  border:2px solid #e0e7ff; transition:all 0.3s;
}
.radio-item:hover{ border-color:#667eea; background:#f8f9ff; }
.radio-item input[type="radio"]{ width:18px; height:18px; cursor:pointer; }
.radio-item.selected{
  background:#667eea; color:#fff; border-color:#667eea;
}
.radio-item.selected input[type="radio"]{ accent-color:#fff; }

.btn-row{ display:flex; gap:12px; margin-top:25px; }
button{
  flex:1; padding:13px; border:none; border-radius:12px;
  cursor:pointer; font-weight:700; font-size:1.05em; transition:all 0.3s;
}
.btn-primary{ background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; }
.btn-primary:hover{ transform:translateY(-2px); }
.btn-reset{ background:#e0e7ff; color:#667eea; font-weight:700; }
.btn-reset:hover{ background:#d3ddff; }

.msg-warn, .msg-confirm{
  display:none; margin-top:15px; padding:13px; border-radius:10px;
  text-align:center; font-weight:700; animation:slideDown 0.3s ease;
}
@keyframes slideDown{
  from{opacity:0; transform:translateY(-10px);}
  to{opacity:1; transform:translateY(0);}
}
.msg-warn{ background:#ffebee; color:#c62828; border-left:4px solid #c62828; }
.msg-confirm{ background:#e8f5e9; color:#2e7d32; border-left:4px solid #2e7d32; }

#bubble{
  position:fixed; bottom:25px; right:25px;
  background:#fff; color:#222;
  padding:16px; border-radius:12px;
  box-shadow:0 8px 24px rgba(0,0,0,.3);
  font-size:1em; font-weight:700;
  display:none; width:320px; max-width:calc(100vw - 50px);
  animation:slide .4s ease; border-left:4px solid #667eea;
  z-index:99999;
}
#bubble.active{ display:flex; gap:12px; }
#bubble-icon{ font-size:1.6em; min-width:28px; }
#bubble-content{ flex:1; }
#bubble-close{
  background:none; border:none; font-size:1.4em; cursor:pointer; opacity:.6;
}
#bubble-close:hover{ opacity:1; color:#667eea; }

.sig{text-align:left; margin-top:25px; color:#999; font-style:italic; font-size:0.85em;}

@media(max-width:600px){
  .container{ padding:20px; }
  h2{ font-size:1.6em; }
  .radio-group{ grid-template-columns:1fr; }
  .candidate-list{ max-height:400px; }
}
</style>
</head>

<body>

<div id="bubble">
  <div id="bubble-icon">ğŸ’¬</div>
  <div id="bubble-content"></div>
  <button id="bubble-close" onclick="closeBubble()">Ã—</button>
</div>

<div id="password-modal">
  <div class="pass-box">
    <div class="pass-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
    <div class="pass-row">
      <input type="password" id="password-input" class="pass-input" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
      <span class="pass-toggle" onclick="togglePass()">ğŸ‘</span>
    </div>
    <button class="pass-btn" onclick="checkPass()">Ø¯Ø®ÙˆÙ„</button>
    <div id="pw-err" class="pass-err">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
  </div>
</div>

<div class="container hidden" id="main-container">
  <h2 id="welcome-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</h2>
  <div class="committee-info">
    <div class="committee-name" id="committee-name-display"></div>
    <div class="committee-address" id="committee-address-display"></div>
  </div>

  <form id="vote-form">
    <label>Ø§Ø³Ù… Ø§Ù„Ù†Ø§Ø®Ø¨:</label>
    <input type="text" id="voter-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù†Ø§Ø®Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">

    <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø´Ø­ (Ø­ØªÙ‰ 2):</label>
    <div class="candidate-list" id="candidate-list"></div>

    <div class="sec-box">
      <span class="sec-title">Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª:</span>
      <div class="radio-group">
        <label class="radio-item"><input type="radio" name="vvalid" value="ØµØ­ÙŠØ­"><span>âœ“ ØµØ­ÙŠØ­</span></label>
        <label class="radio-item"><input type="radio" name="vvalid" value="Ø¨Ø§Ø·Ù„"><span>âœ— Ø¨Ø§Ø·Ù„</span></label>
      </div>
    </div>

    <div class="btn-row">
      <button type="submit" class="btn-primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</button>
      <button type="reset" class="btn-reset">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>

    <div id="msg-warn" class="msg-warn"></div>
    <div id="msg-confirm" class="msg-confirm"></div>
  </form>

  <div class="sig">
    ØªÙ… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø¨ÙˆØ§Ø³Ø·Ø© 
    <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank" style="color:#1e3c72; font-weight:900;">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</a>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBmgHAmoZKm2RRXg42KWdQHD4e5hAUtBbc",
  authDomain: "azizaonly-2ab60.firebaseapp.com",
  databaseURL: "https://azizaonly-2ab60-default-rtdb.firebaseio.com",
  projectId: "azizaonly-2ab60",
  storageBucket: "azizaonly-2ab60.appspot.com",
  messagingSenderId: "447237336190",
  appId: "1:447237336190:web:eab8a2b524b0dcdd5a3c2f",
  measurementId: "G-3DYLFJC5YH"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

window.togglePass = function(){
  const p = document.getElementById("password-input");
  p.type = (p.type === "password") ? "text" : "password";
};

let committeeNumber = 0;

// ğŸ” Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ 
window.checkPass = function(){
  const val = document.getElementById("password-input").value.trim();
  const err = document.getElementById("pw-err");

  // ğŸ”µ Ø§Ù„Ø¥Ø¯Ù…Ù†
  if(val === "521988"){
    document.getElementById("password-modal").classList.add("hidden");
    document.getElementById("main-container").classList.remove("hidden");
    document.getElementById("welcome-title").textContent = "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ù†ØµØ±";
    document.getElementById("committee-name-display").style.display = "none";
    document.getElementById("committee-address-display").style.display = "none";
    committeeNumber = 0;
    return;
  }

  // ğŸ”µ 100124 â†’ Ù„Ø¬Ù†Ø© Ø§Ù„Ø±Ø¬Ø§Ù„ (25)
  if(val === "100124"){
    committeeNumber = 25;
    const info = { name:"Ù„Ø¬Ù†Ø© Ø§Ù„Ø±Ø¬Ø§Ù„ - Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø©", address:"Ù…Ø¯Ø±Ø³Ø© Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©" };
    document.getElementById("password-modal").classList.add("hidden");
    document.getElementById("main-container").classList.remove("hidden");
    document.getElementById("welcome-title").textContent = "Ø§Ù„Ù„Ø¬Ù†Ø© 25";
    document.getElementById("committee-name-display").textContent = info.name;
    document.getElementById("committee-address-display").textContent = info.address;
    return;
  }

  // ğŸ”´ 100125 â†’ Ù„Ø¬Ù†Ø© Ø§Ù„Ù†Ø³Ø§Ø¡ (24)
  if(val === "100125"){
    committeeNumber = 24;
    const info = { name:"Ù„Ø¬Ù†Ø© Ø§Ù„Ù†Ø³Ø§Ø¡ - Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø©", address:"Ù…Ø¯Ø±Ø³Ø© Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©" };
    document.getElementById("password-modal").classList.add("hidden");
    document.getElementById("main-container").classList.remove("hidden");
    document.getElementById("welcome-title").textContent = "Ø§Ù„Ù„Ø¬Ù†Ø© 24";
    document.getElementById("committee-name-display").textContent = info.name;
    document.getElementById("committee-address-display").textContent = info.address;
    return;
  }

  // âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·
  err.style.display = "block";
  setTimeout(()=> err.style.display="none",1500);
};

// Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†
const candidates = [
  ["1","Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø¯Ù‡","ğŸ‘‘"],
  ["2","Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙ…Ø§Ù†Ù‰","ğŸ"],
  ["3","Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯Ù‰","ğŸ¦"],
  ["4","Ø¹Ø§Ø¯Ù„ Ø§Ù„Ø¬ÙŠØ§Ø±","ğŸ¦…"],
  ["5","Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø³Ù…Ø±Ù‡","ğŸ’£"],
  ["6","ÙˆÙ„ÙŠØ¯ ØªÙŠØ³ÙŠØ± Ø§Ù„Ø§Ù…ÙŠØ±","ğŸŠ"],
  ["7","ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹ÙŠØ³ÙˆÙ‰","ğŸŒ€"],
  ["8","Ø§Ù„Ø¨Ø¯ÙˆÙ‰ Ø¬Ù…ÙŠØ²","ğŸ‹"],
  ["9","Ø§Ø­Ù…Ø¯ Ø§Ù„Ø±ÙŠØ³","ğŸ¦‚"],
  ["10","Ø£Ø­Ù…Ø¯ Ø¹ÙˆÙ","âœ‹"],
  ["11","Ø­Ø³Ù† Ø§Ù„Ù…Ù„Ù‡Ø§Ø·","ğŸŒ¿"],
  ["12","Ø¹Ù…Ø±Ùˆ Ù…Ø­Ù…Ø¯ Ø¨Ø­ÙŠØ±Ù‰","ğŸšŒ"],
  ["13","Ø§Ù„Ø³ÙŠØ¯ Ø·Ù…Ø§Ù†","ğŸ”«"],
  ["14","Ù…Ø­Ù…Ø¯ Ø¯Ù†Ø¯Ù†","ğŸš"],
  ["15","Ù…Ø¬Ø¯Ù‰ Ø§Ù„Ø£Ù…ÙŠØ±","ğŸ–Š"]
];

const listBox = document.getElementById("candidate-list");
candidates.forEach((c) => {
  const item = document.createElement("div");
  item.className = "candidate-item";

  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.value = c[1];
  checkbox.className = "candidate-checkbox";

  item.innerHTML = `
    <div class="c-left">
      <div class="num-circle">${c[0]}</div>
      <div class="c-name">${c[1]}</div>
    </div>
    <div class="c-right"><span class="c-icon">${c[2]}</span></div>
  `;

  item.appendChild(checkbox);

  item.onclick = (e) => {
    if(e.target !== checkbox) checkbox.checked = !checkbox.checked;
    checkLimit(); updateStyle();
  };

  checkbox.onchange = () => { checkLimit(); updateStyle(); };

  listBox.appendChild(item);
});

function updateStyle(){
  document.querySelectorAll(".candidate-item").forEach((item)=>{
    const chk = item.querySelector("input[type='checkbox']");
    item.classList.toggle("selected", chk.checked);
  });
}

function checkLimit(){
  const sel = document.querySelectorAll(".candidate-checkbox:checked");
  if(sel.length > 2){
    sel[sel.length-1].checked = false;
    showWarn("ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø´Ø­ÙŠÙ† ÙÙ‚Ø·");
    updateStyle();
  }
}

function showWarn(msg){
  const el = document.getElementById("msg-warn");
  el.textContent = msg;
  el.style.display = "block";
  setTimeout(()=> el.style.display="none",2000);
}

function showConfirm(msg){
  const el = document.getElementById("msg-confirm");
  el.textContent = msg;
  el.style.display = "block";
  setTimeout(()=> el.style.display="none",2000);
}

// Ø­ÙØ¸ Ø§Ù„ØªØµÙˆÙŠØª
document.getElementById("vote-form").addEventListener("submit",(e)=>{
  e.preventDefault();

  let name = document.getElementById("voter-name").value.trim();
  if(!name) name="Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";

  const sel = Array.from(document.querySelectorAll(".candidate-checkbox:checked")).map(c=>c.value);
  const val = document.querySelector("input[name='vvalid']:checked");

  if(sel.length < 1) return showWarn("Ø§Ø®ØªØ± Ù…Ø±Ø´Ø­ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
  if(!val) return showWarn("Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª");

  const voteKey = Date.now();

  const voteRef = ref(db, "votes/" + voteKey);

  set(voteRef,{
    name:name,
    selected:sel,
    vote_validity:val.value,
    committee:committeeNumber,
    timestamp:voteKey
  }).then(()=>{
    showConfirm("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
    document.getElementById("vote-form").reset();
    updateStyle();
  }).catch(err=>{
    showWarn("Ø®Ø·Ø£: "+err.message);
  });

});

</script>
</body>
</html>
