<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª â€“ Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Cairo",sans-serif;}
    body{
      background:linear-gradient(135deg,#1e3c72,#2a5298);
      min-height:100vh;display:flex;justify-content:center;
      align-items:center;padding:20px;color:#fff;
    }
    .hidden{display:none!important;}
    #password-modal{
      position:fixed;inset:0;background:rgba(0,0,0,.8);
      backdrop-filter:blur(8px);display:flex;justify-content:center;
      align-items:center;z-index:9999;
    }
    .pass-box{
      width:90%;max-width:420px;background:#fff;color:#222;padding:30px;
      border-radius:20px;box-shadow:0 15px 50px rgba(0,0,0,.5);
      animation:pop .4s ease;text-align:center;
    }
    @keyframes pop{from{transform:scale(.6);opacity:.2}to{transform:scale(1);opacity:1}}
    .pass-title{font-size:1.6em;font-weight:900;color:#1e3c72;margin-bottom:8px;}
    .pass-subtitle{font-size:1.1em;color:#e91e63;font-weight:bold;margin-bottom:15px;}
    .pass-text{color:#555;margin-top:5px;line-height:1.5;}
    .pass-row{position:relative;margin-top:20px;}
    .pass-input{
      width:100%;padding:15px;text-align:center;border-radius:12px;
      border:2px solid #d7ddff;background:#f4f6ff;
      font-size:1.3em;font-weight:bold;
    }
    .pass-toggle{
      position:absolute;left:15px;top:50%;transform:translateY(-50%);
      font-size:1.5em;color:#1e3c72;cursor:pointer;
    }
    .pass-btn{
      margin-top:20px;width:100%;padding:14px;background:#1e3c72;
      color:#fff;border:none;border-radius:12px;font-size:1.1em;
      font-weight:bold;cursor:pointer;transition:.3s;
    }
    .pass-btn:hover{background:#152d55;}
    .pass-err{margin-top:12px;color:#b90000;font-weight:bold;display:none;font-size:1em;}
    .container{
      width:100%;max-width:780px;background:#fff;color:#222;padding:35px;
      border-radius:22px;box-shadow:0 20px 60px rgba(0,0,0,.4);
    }
    .welcome-header{
      text-align:center;padding:18px;background:#1e3c72;color:#fff;
      border-radius:16px;margin-bottom:25px;font-size:1.7em;font-weight:900;
      box-shadow:0 8px 25px rgba(30,60,114,.4);
    }
    h2{text-align:center;color:#1e3c72;font-size:2em;margin-bottom:8px;}
    .subtitle{text-align:center;color:#555;margin-bottom:25px;}
    label{font-weight:700;color:#1e3c72;margin-top:15px;display:block;}
    input[type=text]{
      width:100%;padding:14px;border-radius:12px;
      border:2px solid #d4ddff;background:#f7f9ff;font-size:1.1em;
    }
    .candidate-list{
      margin-top:15px;background:#f4f6ff;border:1px solid #d9e2ff;
      border-radius:16px;max-height:360px;overflow-y:auto;padding:15px;
    }
    .candidate-item{
      background:#fff;border:1px solid #dfe6ff;padding:12px 15px;
      border-radius:14px;margin-bottom:12px;display:flex;
      justify-content:space-between;align-items:center;cursor:pointer;
      transition:.25s;
    }
    .candidate-item:hover{background:#eef3ff;border-color:#b7c8ff;}
    .c-left{display:flex;align-items:center;gap:12px;}
    .num-circle{
      width:32px;height:32px;border-radius:50%;background:#1e3c72;
      color:#fff;display:flex;align-items:center;justify-content:center;
      font-weight:900;
    }
    .c-name{font-weight:700;color:#1e3c72;}
    .c-icon{font-size:1.8em;}
    .sec-box{
      margin-top:15px;background:#eef2ff;border:1px solid #d3ddff;
      border-radius:14px;padding:16px;
    }
    .sec-box span{font-weight:700;color:#1e3c72;display:block;margin-bottom:8px;}
    .btn-row{display:flex;gap:15px;margin-top:25px;}
    button{
      flex:1;padding:14px;border:none;border-radius:14px;
      cursor:pointer;font-weight:700;font-size:1.1em;transition:.3s;
    }
    .btn-primary{background:#1e3c72;color:#fff;}
    .btn-reset{background:#e8ecff;color:#1e3c72;}
    .msg-warn,.msg-confirm{
      display:none;margin-top:15px;padding:12px;border-radius:12px;
      text-align:center;font-weight:700;font-size:1.05em;
    }
    .msg-warn{background:#ffd8dd;color:#900;}
    .msg-confirm{background:#d4edda;color:#137d37;}
    .sig{text-align:left;margin-top:25px;color:#999;font-style:italic;font-size:.9em;}
  </style>
</head>
<body>

<!-- Ù†Ø§ÙØ°Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± -->
<div id="password-modal">
  <div class="pass-box">
    <div class="pass-title">Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨ÙŠ</div>
    <div class="pass-subtitle">Ù‚Ø³Ù… Ø§Ù„Ø¥Ø´Ø±Ø§Ù</div>
    <div class="pass-text">Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù‚Ø³Ù…</div>
    <div class="pass-row">
      <input type="password" id="password-input" class="pass-input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="off">
      <span class="pass-toggle" onclick="togglePass()">ğŸ‘</span>
    </div>
    <button class="pass-btn" onclick="checkPass()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
    <div id="pw-err" class="pass-err">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
  </div>
</div>

<!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div class="container hidden" id="main-container">
  <div class="welcome-header" id="welcome-message"></div>
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</h2>
  <div class="subtitle">Ù†Ø¸Ø§Ù… Ø­ØµØ± ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª - Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø©</div>

  <form id="vote-form" autocomplete="off">
    <label>Ø§Ø³Ù… Ø§Ù„Ù†Ø§Ø®Ø¨:</label>
    <input type="text" id="voter-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… ÙƒØ§Ù…Ù„Ø§Ù‹" autocomplete="off">

    <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø´Ø­ (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 2):</label>
    <div class="candidate-list" id="candidate-list"></div>

    <div class="sec-box">
      <span>Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª:</span>
      <label><input type="radio" name="vvalid" value="ØµØ­ÙŠØ­"> ØµØ­ÙŠØ­</label>
      <label><input type="radio" name="vvalid" value="Ø¨Ø§Ø·Ù„"> Ø¨Ø§Ø·Ù„</label>
    </div>

    <div class="btn-row">
      <button type="submit" class="btn-primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</button>
      <button type="reset" class="btn-reset">Ù…Ø³Ø­</button>
    </div>

    <div id="msg-warn" class="msg-warn"></div>
    <div id="msg-confirm" class="msg-confirm"></div>
  </form>

  <div class="sig">ØªÙ… ØªØ·ÙˆÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</div>
</div>

<!-- Firebase + Logic -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, push, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyC9j__hwloitAcYuLOyP-ydoB3ffHng0wM",
  authDomain: "elaziza-9c09f.firebaseapp.com",
  databaseURL: "https://elaziza-9c09f-default-rtdb.firebaseio.com",
  projectId: "elaziza-9c09f",
  storageBucket: "elaziza-9c09f.appspot.com",
  messagingSenderId: "166855726580",
  appId: "1:166855726580:web:f9ced2806b65265a8e95a1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let userType = null;

// ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
window.checkPass = function () {
  const pass = document.getElementById("password-input").value.trim();

  if (pass === "205050") userType = "men";
  else if (pass === "506070") userType = "women";
  else {
    showWarnPass();
    return;
  }

  document.getElementById("password-modal").classList.add("hidden");
  document.getElementById("main-container").classList.remove("hidden");
  document.getElementById("welcome-message").textContent =
    userType === "men" ? "Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… â€“ Ø±Ø¬Ø§Ù„ ğŸ§‘" : "Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… â€“ Ù†Ø³Ø§Ø¡ ğŸ‘©";
};

function showWarnPass() {
  const err = document.getElementById("pw-err");
  err.style.display = "block";
  setTimeout(() => err.style.display = "none", 1500);
}

// Ø§Ø¸Ù‡Ø§Ø± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
window.togglePass = function () {
  const p = document.getElementById("password-input");
  p.type = p.type === "password" ? "text" : "password";
};

// Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†
const candidates = [
  ["1","Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø¯Ù‡","ğŸ‘‘"],
  ["2","Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙ…Ø§Ù†Ù‰","ğŸ"],
  ["3","Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯Ù‰","ğŸ¦"],
  ["4","Ø¹Ø§Ø¯Ù„ Ø§Ù„Ø¬ÙŠØ§Ø±","ğŸ¦…"],
  ["5","Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø³Ù…Ø±Ù‡","ğŸ’£"],
  ["6","ÙˆÙ„ÙŠØ¯ ØªÙŠØ³ÙŠØ± Ø§Ù„Ø§Ù…ÙŠØ±","ğŸŠ"],
  ["7","ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹ÙŠØ³ÙˆÙ‰","ğŸŒ€"],
  ["8","Ø§Ù„Ø¨Ø¯ÙˆÙ‰ Ø¬Ù…ÙŠØ²","ğŸ‹"],
  ["9","Ø§Ø­Ù…Ø¯ Ø§Ù„Ø±ÙŠØ³","ğŸ¦‚"],
  ["10","Ø£Ø­Ù…Ø¯ Ø¹ÙˆÙ","âœ‹"],
  ["11","Ø­Ø³Ù† Ø§Ù„Ù…Ù„Ù‡Ø§Ø·","ğŸŒ¿"],
  ["12","Ø¹Ù…Ø±Ùˆ Ù…Ø­Ù…Ø¯ Ø¨Ø­ÙŠØ±Ù‰","ğŸšŒ"],
  ["13","Ø§Ù„Ø³ÙŠØ¯ Ø·Ù…Ø§Ù†","ğŸ”«"],
  ["14","Ù…Ø­Ù…Ø¯ Ø¯Ù†Ø¯Ù†","ğŸš"],
  ["15","Ù…Ø¬Ø¯Ù‰ Ø§Ù„Ø£Ù…ÙŠØ±","ğŸ–Š"]
];

const listBox = document.getElementById("candidate-list");

candidates.forEach(c => {
  const item = document.createElement("div");
  item.className = "candidate-item";
  const box = document.createElement("input");
  box.type = "checkbox";
  box.value = c[1];
  box.className = "candidate-checkbox";
  item.innerHTML = `
    <div class="c-left">
      <div class="num-circle">${c[0]}</div>
      <div class="c-name">${c[1]}</div>
    </div>
    <div class="c-right"><span class="c-icon">${c[2]}</span></div>`;
  item.appendChild(box);
  item.addEventListener("click", e => {
    if (e.target !== box) box.checked = !box.checked;
    limitSelect();
  });
  box.addEventListener("change", limitSelect);
  listBox.appendChild(item);
});

function limitSelect() {
  const selected = document.querySelectorAll(".candidate-checkbox:checked");
  if (selected.length > 2) {
    selected[selected.length - 1].checked = false;
    showWarn("ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø´Ø­ÙŠÙ† ÙÙ‚Ø·");
  }
}

function invalidName(name) {
  if (name.length < 4) return true;
  if (/[0-9]/.test(name)) return true;
  if (/[^Ø¡-ÙŠ\s]/.test(name)) return true;
  return false;
}

async function isNameUsed(name) {
  if (!userType) return false;
  const q = query(ref(db, `votes_${userType}`), orderByChild("name"), equalTo(name));
  const snap = await get(q);
  return snap.exists();
}

document.getElementById("vote-form").addEventListener("submit", async (e) => {
  e.preventDefault();
  if (!userType) return showWarn("ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù‚Ø³Ù…");

  const name = document.getElementById("voter-name").value.trim();
  const selected = [...document.querySelectorAll(".candidate-checkbox:checked")].map(c => c.value);
  const validity = document.querySelector('input[name="vvalid"]:checked');

  if (invalidName(name)) return showWarn("Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± ØµØ­ÙŠØ­");
  if (selected.length === 0) return showWarn("Ø§Ø®ØªØ± Ù…Ø±Ø´Ø­ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
  if (!validity) return showWarn("Ø­Ø¯Ø¯ Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª");
  if (await isNameUsed(name)) return showWarn("Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§");

  push(ref(db, `votes_${userType}`), {
    name,
    selected,
    vote_validity: validity.value,
    timestamp: Date.now()
  }).then(() => {
    showConfirm("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª âœ“");
    document.getElementById("vote-form").reset();
    document.querySelectorAll(".candidate-checkbox").forEach(c => c.checked = false);
  }).catch(err => showWarn("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„: " + err.message));
});

function showWarn(msg) {
  const el = document.getElementById("msg-warn");
  el.textContent = msg;
  el.style.display = "block";
  setTimeout(() => el.style.display = "none", 2500);
}
function showConfirm(msg) {
  const el = document.getElementById("msg-confirm");
  el.textContent = msg;
  el.style.display = "block";
  setTimeout(() => el.style.display = "none", 2500);
}
</script>
</body>
</html>
