<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª - Ø§Ù„Ø¹Ø²ÙŠØ²Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Cairo",sans-serif;}
body{
    background:linear-gradient(135deg,#667eea,#764ba2);
    min-height:100vh;display:flex;justify-content:center;align-items:center;
    padding:15px;color:#333;
}
.hidden{display:none!important;}
.container{
    width:100%;max-width:800px;background:#fff;padding:30px;border-radius:20px;
    box-shadow:0 20px 60px rgba(0,0,0,.3);animation:fade .5s ease;
}
@keyframes fade{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}

#login-box{
    position:fixed;top:0;left:0;width:100%;height:100%;
    background:#fff;z-index:9999999;display:flex;justify-content:center;align-items:center;
}

.committee-info{background:#f5f7ff;padding:15px;text-align:center;border-radius:12px;border-right:4px solid #667eea;margin-bottom:20px;}
.candidate-list{margin-top:10px;background:#f8f9ff;border:2px solid #e0e7ff;border-radius:14px;max-height:50vh;overflow-y:auto;padding:10px;}
.candidate-item{background:#fff;border:1px solid #e8ecff;padding:12px;border-radius:12px;margin-bottom:8px;display:flex;justify-content:space-between;cursor:pointer;}
.candidate-item.selected{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;}
.radio-item{padding:12px;border:2px solid #e0e7ff;border-radius:10px;cursor:pointer;text-align:center;}
.radio-item.selected{background:#667eea;color:#fff;}
</style>
</head>

<body>

<!-- Ø´Ø§Ø´Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± -->
<div id="login-box">
  <div style="background:#f5f5f5;padding:30px;border-radius:15px;width:90%;max-width:350px;text-align:center;box-shadow:0 0 20px rgba(0,0,0,.2);">
    <h3 style="margin-bottom:15px;">ğŸ” Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</h3>
    <input id="pass-input" type="password" placeholder="*******"
           style="width:100%;padding:12px;border-radius:10px;border:1px solid #ccc;text-align:center;margin-bottom:15px;">
    <button id="pass-btn" style="width:100%;padding:12px;background:#667eea;color:#fff;border:none;border-radius:10px;font-weight:bold;">
      Ø¯Ø®ÙˆÙ„
    </button>
    <p id="pass-error" style="color:red;margin-top:10px;display:none;"></p>
  </div>
</div>

<div class="container hidden" id="main-container">
  <h2 id="welcome-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª - Ø§Ù„Ø¹Ø²ÙŠØ²Ø©</h2>

  <div class="committee-info">
    <div id="committee-name-display">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    <div id="committee-address-display">Ù…Ø¯Ø±Ø³Ø© Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©</div>
  </div>

  <form id="vote-form">
    <label>Ø§Ø³Ù… Ø§Ù„Ù†Ø§Ø®Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <input type="text" id="voter-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§...">

    <label>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø´Ø­ (Ø­Ø¯ Ø£Ù‚ØµÙ‰ 2):</label>
    <div id="candidate-list" class="candidate-list"></div>

    <div class="sec-box" style="background:#f5f7ff;border:2px solid #e0e7ff;border-radius:12px;padding:15px;margin-top:20px;">
        <span>Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª:</span>
        <div class="radio-group" style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
            <label class="radio-item"><input type="radio" name="vvalid" value="ØµØ­ÙŠØ­" hidden> âœ“ ØµØ­ÙŠØ­</label>
            <label class="radio-item"><input type="radio" name="vvalid" value="Ø¨Ø§Ø·Ù„" hidden> âœ— Ø¨Ø§Ø·Ù„</label>
        </div>
    </div>

    <div style="display:flex;gap:10px;margin-top:20px;">
      <button type="submit" class="btn-primary" style="flex:1;background:#667eea;color:#fff;border:none;padding:14px;border-radius:12px;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</button>
      <button type="reset" class="btn-reset" style="flex:1;background:#e0e7ff;color:#667eea;border:none;padding:14px;border-radius:12px;">ØªÙØ±ÙŠØº</button>
      <button type="button" class="btn-logout" style="flex:1;background:#ffebee;color:#c62828;border:none;padding:14px;border-radius:12px;">Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="msg-warn" style="display:none;color:red;text-align:center;margin-top:10px;"></div>
    <div id="msg-confirm" style="display:none;color:green;text-align:center;margin-top:10px;"></div>
  </form>
</div>

<script>
// -------------------- Ù†Ø¸Ø§Ù… ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± --------------------
document.getElementById("pass-btn").addEventListener("click", () => {
  const pass = document.getElementById("pass-input").value.trim();
  const err = document.getElementById("pass-error");

  if (pass === "ma100124") {
      localStorage.setItem("committee", "men");
      location.reload();
  }
  else if (pass === "wa100125") {
      localStorage.setItem("committee", "women");
      location.reload();
  }
  else {
      err.textContent = "âŒ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
      err.style.display = "block";
  }
});
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBmgHAmoZKm2RRXg42KWdQHD4e5hAUtBbc",
  authDomain: "azizaonly-2ab60.firebaseapp.com",
  databaseURL: "https://azizaonly-2ab60-default-rtdb.firebaseio.com",
  projectId: "azizaonly-2ab60",
  storageBucket: "azizaonly-2ab60.appspot.com",
  messagingSenderId: "447237336190",
  appId: "1:447237336190:web:eab8a2b524b0dcdd5a3c2f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

// -------------------- Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù„Ø¬Ù†Ø© --------------------
const committeeType = localStorage.getItem("committee");

if (!committeeType) {
    // Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    document.getElementById("main-container").classList.add("hidden");
    document.getElementById("login-box").style.display = "flex";
    throw "NO_LOGIN";
}

let committeeNumber = 0;
let committeeName = "";

if (committeeType === "men") {
  committeeNumber = 24;
  committeeName = "Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© - Ù„Ø¬Ù†Ø© Ø§Ù„Ø±Ø¬Ø§Ù„";
} else {
  committeeNumber = 25;
  committeeName = "Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© - Ù„Ø¬Ù†Ø© Ø§Ù„Ù†Ø³Ø§Ø¡";
}

document.getElementById("committee-name-display").textContent = committeeName;
document.getElementById("welcome-title").textContent = "Ø§Ù„Ù„Ø¬Ù†Ø© Ø±Ù‚Ù… " + committeeNumber;

// Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØµÙØ­Ø©
document.getElementById("login-box").style.display = "none";
document.getElementById("main-container").classList.remove("hidden");

// -------------------- Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ† --------------------
const candidates = [
  ["1","Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø¯Ù‡","ğŸ‘‘"],["2","Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙ…Ø§Ù†Ù‰","ğŸ"],["3","Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯Ù‰","ğŸ¦"],
  ["4","Ø¹Ø§Ø¯Ù„ Ø§Ù„Ø¬ÙŠØ§Ø±","ğŸ¦…"],["5","Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø³Ù…Ø±Ù‡","ğŸ’£"],["6","ÙˆÙ„ÙŠØ¯ ØªÙŠØ³ÙŠØ± Ø§Ù„Ø§Ù…ÙŠØ±","ğŸŠ"],
  ["7","ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹ÙŠØ³ÙˆÙ‰","ğŸŒ€"],["8","Ø§Ù„Ø¨Ø¯ÙˆÙ‰ Ø¬Ù…ÙŠØ²","ğŸ‹"],["9","Ø§Ø­Ù…Ø¯ Ø§Ù„Ø±ÙŠØ³","ğŸ¦‚"],
  ["10","Ø£Ø­Ù…Ø¯ Ø¹ÙˆÙ","âœ‹"],["11","Ø­Ø³Ù† Ø§Ù„Ù…Ù„Ù‡Ø§Ø·","ğŸŒ¿"],["12","Ø¹Ù…Ø±Ùˆ Ù…Ø­Ù…Ø¯ Ø¨Ø­ÙŠØ±Ù‰","ğŸšŒ"],
  ["13","Ø§Ù„Ø³ÙŠØ¯ Ø·Ù…Ø§Ù†","ğŸ”«"],["14","Ù…Ø­Ù…Ø¯ Ø¯Ù†Ø¯Ù†","ğŸš"],["15","Ù…Ø¬Ø¯Ù‰ Ø§Ù„Ø£Ù…ÙŠØ±","ğŸ–Š"]
];

const listBox = document.getElementById("candidate-list");

candidates.forEach(c=>{
  const item=document.createElement("div");
  item.className="candidate-item";
  const checkbox=document.createElement("input");
  checkbox.type="checkbox";
  checkbox.value=c[1];
  checkbox.className="candidate-checkbox";
  item.innerHTML=`<div style="display:flex;align-items:center;gap:10px;"><div class="num-circle">${c[0]}</div>${c[1]}</div><div style="font-size:1.5em;">${c[2]}</div>`;
  item.appendChild(checkbox);
  item.addEventListener("click",(e)=>{if(e.target!==checkbox)checkbox.checked=!checkbox.checked;updateSelection();});
  checkbox.addEventListener("change",updateSelection);
  listBox.appendChild(item);
});

function updateSelection(){
  const checked=document.querySelectorAll(".candidate-checkbox:checked");
  if(checked.length>2){
      checked[checked.length-1].checked=false;
      showWarn("âš ï¸ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø´Ø­ÙŠÙ† ÙÙ‚Ø·");
  }
  document.querySelectorAll(".candidate-item").forEach(item=>{
      const cb=item.querySelector("input");
      item.classList.toggle("selected",cb.checked);
  });
}

document.querySelectorAll("input[name='vvalid']").forEach(r=>{
  r.addEventListener("change",()=>{
    document.querySelectorAll(".radio-item").forEach(x=>x.classList.remove("selected"));
    r.closest(".radio-item").classList.add("selected");
  });
});

// Ø±Ø³Ø§Ø¦Ù„
function showWarn(msg){const b=document.getElementById("msg-warn");b.textContent=msg;b.style.display="block";setTimeout(()=>b.style.display="none",2500);}
function showConfirm(msg){const b=document.getElementById("msg-confirm");b.textContent=msg;b.style.display="block";setTimeout(()=>b.style.display="none",3000);}

// Ø­ÙØ¸ Ø§Ù„ØªØµÙˆÙŠØª
document.getElementById("vote-form").addEventListener("submit",e=>{
  e.preventDefault();

  let voterName=document.getElementById("voter-name").value.trim();
  if(!voterName)voterName="Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";

  const selected=Array.from(document.querySelectorAll(".candidate-checkbox:checked")).map(x=>x.value);
  const validity=document.querySelector("input[name='vvalid']:checked");

  if(selected.length<1)return showWarn("â— Ø§Ø®ØªØ± Ù…Ø±Ø´Ø­ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
  if(!validity)return showWarn("â— Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª");

  const btn=document.querySelector(".btn-primary");
  btn.disabled=true;btn.textContent="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";

  const key=Date.now();
  set(ref(db,"votes/aziza/"+key),{
      name:voterName,
      selected:selected,
      vote_validity:validity.value,
      committee:committeeNumber,
      timestamp:key
  })
  .then(()=>{showConfirm("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!");document.getElementById("vote-form").reset();})
  .catch(err=>showWarn("âŒ Ø®Ø·Ø£: "+err.message))
  .finally(()=>{btn.disabled=false;btn.textContent="ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª";});
});

// Ø®Ø±ÙˆØ¬
document.querySelector(".btn-logout").addEventListener("click",()=>{
  localStorage.removeItem("committee");
  location.reload();
});
</script>

</body>
</html>
