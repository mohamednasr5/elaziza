<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© - Ø§Ù„Ø¹Ø²ÙŠØ²Ø©</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
<style>
:root {
Â  Â  --primary: #11998e;
Â  Â  --secondary: #38ef7d;
Â  Â  --danger: #eb3349;
Â  Â  --warning: #f6ad55;
Â  Â  --info: #63b3ed;
Â  Â  --dark: #1a202c;
Â  Â  --light: #f7fafc;
Â  Â  --card-bg: #ffffff;
Â  Â  --accent: #764ba2;
Â  Â  --shadow: 0 10px 15px -3px rgba(0,0,0,0.12), 0 4px 6px -2px rgba(0,0,0,0.07);
}
/* Ù‚Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù…Ø© */
*, *:before, *:after {margin:0;padding:0;box-sizing:border-box;font-family:"Cairo",sans-serif;outline:none;}
body {background: #f0f2f5; color: var(--dark); min-height:100vh;padding-bottom:50px; font-size:14px;}
/* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ - ØªØµÙ…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¬Ø¯ÙŠØ¯ */
#lock-screen {
    position: fixed; inset: 0;
    /* ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ø£ÙƒØ«Ø± Ø­ÙŠÙˆÙŠØ© ÙˆÙ…Ø±ÙˆÙ†Ø© */
    background: linear-gradient(135deg, #4c4c4c 0%, #1a1a1a 100%);
    display: flex; justify-content: center; align-items: center; z-index: 10000; padding: 20px;
}
.lock-box {
    /* ØªØ£Ø«ÙŠØ± Glassmorphism / Neumorphism */
    background: rgba(255, 255, 255, 0.08); /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© Ù‚Ù„ÙŠÙ„Ø§Ù‹ */
    padding: 45px 35px; max-width: 380px; width: 100%; border-radius: 28px;
    text-align: center; color: #f7fafc; /* Ù„ÙˆÙ† Ù†Øµ ÙØ§ØªØ­ */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), /* Ø¸Ù„ Ø³ÙÙ„ÙŠ Ù‚ÙˆÙŠ */
                inset 0 0 0 1px rgba(255, 255, 255, 0.1); /* Ø¥Ø·Ø§Ø± Ø¯Ø§Ø®Ù„ÙŠ Ø®ÙÙŠÙ */
    backdrop-filter: blur(12px); /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø²Ø¬Ø§Ø¬ */
    border: 1px solid rgba(255, 255, 255, 0.15); /* Ø¥Ø·Ø§Ø± Ø®ÙÙŠÙ */
    animation: slideInDown 0.6s cubic-bezier(.4, 0, .2, 1);
}
@keyframes slideInDown {
    from { opacity: 0; transform: translateY(-30px); }
    to { opacity: 1; transform: translateY(0); }
}
.lock-box h2 {
    color: #38ef7d; /* Ù„ÙˆÙ† Ø«Ø§Ù†ÙˆÙŠ Ù…Ù…ÙŠØ² */
    margin-bottom: 8px; font-size: 2rem; font-weight: 900;
    text-shadow: 0 0 15px rgba(56, 239, 125, 0.3);
}
.lock-box p { color: #cbd5e0; margin-bottom: 30px; }
.lock-input-group { position: relative; margin: 25px 0; }
.lock-box input {
    width: 100%; padding: 15px 20px; border-radius: 15px;
    border: 2px solid rgba(255, 255, 255, 0.15);
    background: rgba(0, 0, 0, 0.3); /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ù„Ù„Ù…Ø¯Ø®Ù„ */
    font-size: 1.1rem; text-align: center; color: #f7fafc;
    transition: all 0.3s;
}
.lock-box input:focus {
    border-color: #38ef7d; /* Ø¥Ø·Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
    box-shadow: 0 0 15px rgba(56, 239, 125, 0.5);
    background: rgba(0, 0, 0, 0.5);
}
.lock-btn {
    width: 100%; padding: 16px;
    /* ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ù„Ù„Ø²Ø± */
    background: linear-gradient(100deg, var(--primary) 0%, var(--secondary) 100%);
    color: var(--dark); /* Ù†Øµ Ø¯Ø§ÙƒÙ† Ø¹Ù„Ù‰ Ø²Ø± ÙØ§ØªØ­ */
    border: none; border-radius: 15px;
    font-size: 1.1rem; font-weight: 800; cursor: pointer;
    box-shadow: 0 12px 25px rgba(17, 153, 142, 0.4);
    transition: transform .2s, box-shadow .3s;
}
.lock-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 30px rgba(17, 153, 142, 0.6);
}
.lock-btn:active { transform: scale(0.98); }
.lock-box #login-error { color: #ff8a8a; font-weight: 700; margin-top: 15px; }

/* ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª (Ù„Ù… ØªÙØ¹Ø¯Ù„) ... */

.hidden { display:none!important;}
.container {max-width:1400px;margin:auto;padding:15px;}
.header {display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:15px;margin-bottom:25px;background:var(--card-bg);padding:20px;border-radius:16px;box-shadow:var(--shadow);}
.header-title h1 {font-size:1.5rem;font-weight:900;background:linear-gradient(90deg,var(--primary),var(--secondary));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
.header-badges {display: flex; gap: 10px; align-items: center;}
.badge {padding:6px 12px;border-radius:20px;font-size:0.85rem;font-weight:700;display:flex;align-items:center;gap:6px;}
.badge-admin {background:#e2e8f0;color:var(--dark);}
.badge-live {background:#def7ec;color:#03543f;}
.dot {width:8px;height:8px;background:var(--secondary);border-radius:50%;animation:pulse 1.5s infinite;}
@keyframes pulse{0%{opacity:1;}50%{opacity:0.4;}100%{opacity:1;}}
.grid-cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:15px;margin-bottom:30px;}
.stat-card {background:var(--card-bg);padding:20px;border-radius:16px;box-shadow:var(--shadow);border-bottom:4px solid var(--primary);display: flex;flex-direction:column;justify-content:space-between;transition:transform .2s;}
.stat-card:hover {transform:translateY(-5px);}
.stat-title {color:#718096;font-size:0.85rem;font-weight:600;margin-bottom:5px;}
.stat-value {font-size:1.8rem;font-weight:800;color:var(--dark);}
.stat-sub{font-size:0.75rem;color:#a0aec0;}
.main-grid{display:grid;grid-template-columns:2fr 1fr;gap:25px;margin-bottom:30px;}
.panel{background:var(--card-bg);padding:20px;border-radius:16px;box-shadow:var(--shadow);height:100%;display:flex;flex-direction:column;}
.panel h3{margin-bottom:15px;font-size:1.1rem;color:var(--primary);border-bottom:2px solid #f0f0f0;padding-bottom:10px;}
canvas{width:100%!important;height:auto!important;max-height:300px;}
.comm-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;}
.comm-box {padding:15px;border-radius:12px;background:#f7fafc;border:1px solid #e2e8f0;cursor:pointer;transition:0.3s;}
.comm-box:hover{background:var(--primary);color:white;border-color:var(--primary);}
.comm-box h4{font-size:1rem;margin-bottom:5px;}
.comm-stats{font-size:0.8rem;opacity:0.8;}
.notify-area textarea {width:100%;padding:12px;border:2px solid #e2e8f0;border-radius:12px;resize:none;height:80px;margin-bottom:10px;transition:.3s;}
.notify-area textarea:focus {border-color:var(--primary);}
.notify-options{display:flex;gap:15px;margin-bottom:10px;}
.table-controls{display:flex;gap:10px;margin-bottom:15px;flex-wrap:wrap;}
.search-box {flex:1;padding:10px 15px;border-radius:10px; border:1px solid #cbd5e0;min-width:180px;}
.btn-action{padding:10px 15px;border:none;border-radius:10px;cursor:pointer;color:white;font-weight:bold;font-size:0.85rem;transition:0.2s;display:inline-flex;align-items:center;justify-content:center;gap:5px;}
.btn-blue{background:var(--info);}
.btn-green{background:var(--secondary);}
.btn-red{background:var(--danger);}
.btn-action:hover{opacity:0.9;transform:translateY(-1px);}
.table-wrap{overflow-x:auto;border-radius:12px;border:1px solid #e2e8f0;-webkit-overflow-scrolling:touch;}
table{width:100%;border-collapse:collapse;min-width:650px;}
thead{background:#f7fafc;}
th,td{padding:12px;text-align:right;border-bottom:1px solid #e2e8f0;font-size:0.92rem;}
th{color:#4a5568;}
tr:hover{background:#f8fff9;}
.status-ok{color:var(--primary);font-weight:bold;background:#e6fffa;padding:4px 8px;border-radius:6px;white-space:nowrap;font-size:0.83rem;}
.status-bad{color:var(--danger);font-weight:bold;background:#fff5f5;padding:4px 8px;border-radius:6px;white-space:nowrap;font-size:0.83rem;}
.ranking-item {display:flex;justify-content:space-between;align-items:center;padding:10px;border-bottom:1px solid #eee;transition:0.2s;}
.ranking-item:last-child{border-bottom:none;}
.ranking-item:hover{background:#f9fafb;padding-right:10px;}
.rank-bar-bg{flex:1;height:8px;background:#edf2f7;margin:0 15px;border-radius:4px;overflow:hidden;}
.rank-bar-fill{height:100%;background:var(--primary);border-radius:4px;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;justify-content:center;align-items:center;z-index:5000;backdrop-filter:blur(4px);padding:20px;}
.popup{background:white;width:100%;max-width:500px;border-radius:16px;padding:25px;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25);animation:slideUp .3s ease;max-height:90vh;overflow-y:auto;}
@keyframes slideUp{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
.popup-header{display:flex;justify-content:space-between;margin-bottom:20px;font-size:1.25rem;font-weight:bold;color:var(--dark);}
.close-btn{background:none;border:none;font-size:1.6rem;cursor:pointer;color:#a0aec0;}
.edit-option{display:flex;justify-content:space-between;padding:12px;border:1px solid #e2e8f0;border-radius:8px;margin-bottom:8px;cursor:pointer;}
.edit-option input{width:20px;height:20px;accent-color:var(--primary);}
.edit-option:hover{background:#f7fafc;}
.detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:17px;}
.detail-box{background:#f8fafc;padding:15px;border-radius:12px;text-align:center;border:1px solid #edf2f7;}
.detail-val{font-size:1.4rem;font-weight:800;color:var(--dark);}
.detail-lbl{font-size:0.83rem;color:#718096;margin-top:5px;}
.status-indicator{padding:10px;border-radius:8px;text-align:center;margin-bottom:15px;font-weight:bold;}
.is-active{background:#def7ec;color:#03543f;border:1px solid #38ef7d;}
.is-inactive{background:#fed7d7;color:#9b2c2c;border:1px solid #f56565;}
.toast{position:fixed;bottom:22px;right:22px;background:var(--dark);color:white;padding:12px 24px;border-radius:8px;z-index:9999;font-weight:bold;box-shadow:0 4px 6px rgba(0,0,0,0.1);display:none;animation:fadeIn 0.3s;}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
@media (max-width:1024px){.main-grid{grid-template-columns:1fr;}}
@media (max-width:600px){
Â  Â  .header{flex-direction:column;align-items:flex-start;padding:15px;}
Â  Â  .header-badges{width:100%;justify-content:space-between;margin-top:10px;}
Â  Â  .comm-grid{grid-template-columns:1fr;}
Â  Â  .table-controls{flex-direction:column;}
Â  Â  .btn-action,.search-box{width:100%;}
Â  Â  .stat-value{font-size:1.16rem;}
Â  Â  .grid-cards{grid-template-columns:1fr 1fr;}
}
</style>
</head>
<body>
<div id="lock-screen">
Â  Â  <div class="lock-box">
Â  Â  Â  Â  <h2>ğŸ” Ø§Ù„Ø¹Ø²ÙŠØ²Ø© ÙƒÙ†ØªØ±ÙˆÙ„</h2>
Â  Â  Â  Â  <p style="color:#cbd5e0; margin-bottom:30px; font-size:0.95rem;">Ù„ÙˆØ­Ø© Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø§Ù†ØªØ®Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</p>
Â  Â  Â  Â  <div class="lock-input-group">
Â  Â  Â  Â  Â  Â  <input type="password" id="lock-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button class="lock-btn" onclick="unlockSystem()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
Â  Â  Â  Â  <div id="login-error" style="color: var(--danger); margin-top: 10px; display:none;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!</div>
Â  Â  </div>
</div>
<div id="dashboard" class="container hidden">
Â  Â  <div class="header">
Â  Â  Â  Â  <div class="header-title">
Â  Â  Â  Â  Â  Â  <h1>ğŸ›ï¸ Ù„ÙˆØ­Ø© Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¹Ø²ÙŠØ²Ø©</h1>
Â  Â  Â  Â  Â  Â  <p style="color:#718096; font-size:0.9rem;">Ù…ØªØ§Ø¨Ø¹Ø© Ø­ÙŠØ© Ù„Ù„Ø¬Ù†Ø© 24 (Ø±Ø¬Ø§Ù„) ÙˆØ§Ù„Ù„Ø¬Ù†Ø© 25 (Ù†Ø³Ø§Ø¡)</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="header-badges">
Â  Â  Â  Â  Â  Â  <div class="badge badge-live"><div class="dot"></div> <span id="conn-status">Ù…ØªØµÙ„</span></div>
Â  Â  Â  Â  Â  Â  <div class="badge badge-admin" id="user-role">Ø²Ø§Ø¦Ø±</div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="grid-cards">
Â  Â  Â  Â  <div class="stat-card"><div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆØ§Øª</div>
Â  Â  Â  Â  Â  Â  <div class="stat-value" id="total-votes">0</div>
Â  Â  Â  Â  Â  Â  <div class="stat-sub">ÙÙŠ Ø§Ù„Ù„Ø¬Ù†ØªÙŠÙ†</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-card" style="border-bottom-color: var(--info);">
Â  Â  Â  Â  Â  Â  <div class="stat-title">Ø£ØµÙˆØ§Øª Ø¢Ø®Ø± Ø³Ø§Ø¹Ø©</div>
Â  Â  Â  Â  Â  Â  <div class="stat-value" style="color:var(--info)" id="last-hour-votes">0</div>
Â  Â  Â  Â  Â  Â  <div class="stat-sub">Ù…Ø¤Ø´Ø± Ø§Ù„Ø²Ø®Ù…</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-card" style="border-bottom-color: var(--warning);">
Â  Â  Â  Â  Â  Â  <div class="stat-title">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©</div>
Â  Â  Â  Â  Â  Â  <div class="stat-value" style="color:var(--warning)" id="avg-per-min">0</div>
Â  Â  Â  Â  Â  Â  <div class="stat-sub">Ù…Ù†Ø° Ø¨Ø¯Ø¡ Ø§Ù„ØªØµÙˆÙŠØª</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  <div class="stat-title">Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØµØ­ÙŠØ­Ø©</div>
Â  Â  Â  Â  Â  Â  <div class="stat-value" style="color:var(--primary)" id="valid-votes">0</div>
Â  Â  Â  Â  Â  Â  <div class="stat-sub">Ø¨Ù†Ø³Ø¨Ø© <span id="valid-percent">0%</span></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  Â  Â  <div class="stat-title">Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„Ø¨Ø§Ø·Ù„Ø©</div>
Â  Â  Â  Â  Â  Â  <div class="stat-value" style="color:var(--danger)" id="invalid-votes">0</div>
Â  Â  Â  Â  Â  Â  <div class="stat-sub">Ø¨Ù†Ø³Ø¨Ø© <span id="invalid-percent">0%</span></div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="main-grid">
Â  Â  Â  Â  <div style="display:flex;flex-direction:column;gap:25px;">
Â  Â  Â  Â  Â  Â  <div class="panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="position:relative; flex:1;min-height:250px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="barChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ“ˆ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø²Ù…Ù†ÙŠ (Ø¨Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="position: relative; flex:1;min-height:200px;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <canvas id="lineChart"></canvas>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="display:flex;flex-direction:column;gap:25px;">
Â  Â  Â  Â  Â  Â  <div class="panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ¢ Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¬Ø§Ù† (Ø§Ø¶ØºØ· Ù„Ù„ØªÙØ§ØµÙŠÙ„)</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="comm-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="comm-box" onclick="showCommitteeDetails(24)"><h4>Ù„Ø¬Ù†Ø© 24 (Ø±Ø¬Ø§Ù„)</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="comm-stats" id="comm-24-stats">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="comm-box" onclick="showCommitteeDetails(25)"><h4>Ù„Ø¬Ù†Ø© 25 (Ù†Ø³Ø§Ø¡)</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="comm-stats" id="comm-25-stats">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
            Â  Â  Â  Â  Â  Â  <div class="panel" style="flex:1;">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ† ØªØ±ØªÙŠØ¨ Ø§Ù„ØµØ¯Ø§Ø±Ø©</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="ranking-container" style="max-height:400px;overflow-y:auto;"></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="panel">
Â  Â  Â  Â  Â  Â  Â  Â  <h3>ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡</h3>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="notify-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="notify-options">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label><input type="radio" name="n-target" value="24"> Ø±Ø¬Ø§Ù„</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label style="margin-right:10px;"><input type="radio" name="n-target" value="25"> Ù†Ø³Ø§Ø¡</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label><input type="radio" name="n-target" value="both" checked> Ù„Ù„Ø¬Ù†ØªÙŠÙ†</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <textarea id="notify-msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªØµÙˆÙŠØª..."></textarea>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-action btn-blue" style="width:100%" onclick="sendNotify()">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div class="panel">
Â  Â  Â  Â  <h3>ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h3>
Â  Â  Â  Â  <div class="table-controls">
Â  Â  Â  Â  Â  Â  <input type="text" id="search-inp" class="search-box" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ù†Ø§Ø®Ø¨ Ø£Ùˆ Ù…Ø±Ø´Ø­..." onkeyup="renderTable()">
Â  Â  Â  Â  Â  Â  <button class="btn-action btn-green" onclick="exportExcel()">ğŸ“¥ ØªØµØ¯ÙŠØ± Excel</button>
Â  Â  Â  Â  Â  Â  <button class="btn-action btn-blue" onclick="filterTableByCommittee('all')">Ø§Ù„ÙƒÙ„</button>
Â  Â  Â  Â  Â  Â  <button id="btn-reset" class="btn-action btn-red hidden" onclick="resetAllData()">âš ï¸ ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="table-wrap">
Â  Â  Â  Â  Â  Â  <table id="main-table">
Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>#</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Ø§Ù„Ø§Ø³Ù…</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Ø§Ù„Ù„Ø¬Ù†Ø©</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>ÙˆÙ‚Øª Ø§Ù„ØªØµÙˆÙŠØª</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="admin-col hidden">ØªØ­ÙƒÙ…</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="table-body"></tbody>
Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>
<div id="edit-popup" class="overlay hidden">
Â  Â  <div class="popup">
Â  Â  Â  Â  <div class="popup-header">
Â  Â  Â  Â  Â  Â  <span>ØªØ¹Ø¯ÙŠÙ„ ØµÙˆØª</span>
Â  Â  Â  Â  Â  Â  <button class="close-btn" onclick="closePopup('edit-popup')">&times;</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="margin-bottom:15px;font-weight:bold;color:var(--primary);" id="edit-voter-name"></div>
Â  Â  Â  Â  <div id="edit-options-list"></div>
Â  Â  Â  Â  <div style="display:flex;gap:10px;margin-top:20px;">
Â  Â  Â  Â  Â  Â  <button class="btn-action btn-green" style="flex:1" onclick="saveEditVote()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
Â  Â  Â  Â  Â  Â  <button class="btn-action btn-red" onclick="deleteSingleVote()">Ø­Ø°Ù Ø§Ù„ØµÙˆØª</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  </div>
</div>
<div id="details-popup" class="overlay hidden">
Â  Â  <div class="popup">
Â  Â  Â  Â  <div class="popup-header">
Â  Â  Â  Â  Â  Â  <span id="dt-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù„Ø¬Ù†Ø©</span>
Â  Â  Â  Â  Â  Â  <button class="close-btn" onclick="closePopup('details-popup')">&times;</button>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="dt-status" class="status-indicator"></div>
Â  Â  Â  Â  <div class="detail-grid">
Â  Â  Â  Â  Â  Â  <div class="detail-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-val" id="dt-total">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆØ§Øª</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="detail-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-val" style="color:var(--primary)" id="dt-valid">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-lbl">ØµØ­ÙŠØ­Ø©</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="detail-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-val" style="color:var(--danger)" id="dt-invalid">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-lbl">Ø¨Ø§Ø·Ù„Ø©</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="detail-box">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-val" id="dt-avg-hour">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-lbl">Ù…ØªÙˆØ³Ø· / Ø³Ø§Ø¹Ø©</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div class="detail-box" style="grid-column:span 2;">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-val" id="dt-avg-min">0</div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="detail-lbl">Ù…ØªÙˆØ³Ø· / Ø¯Ù‚ÙŠÙ‚Ø©</div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style="margin-top:20px;">
Â  Â  Â  Â  Â  Â  Â <button class="btn-action btn-blue" style="width:100%" onclick="filterTableFromPopup()">ğŸ” Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¬Ù†Ø© ÙÙ‚Ø·</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>
<div id="toast" class="toast"></div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, onValue, set, update, remove, push } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
const firebaseConfig = {
Â  apiKey: "AIzaSyBmgHAmoZKm2RRXg42KWdQHD4e5hAUtBbc",
Â  authDomain: "azizaonly-2ab60.firebaseapp.com",
Â  databaseURL: "https://azizaonly-2ab60-default-rtdb.firebaseio.com",
Â  projectId: "azizaonly-2ab60",
Â  storageBucket: "azizaonly-2ab60.appspot.com",
Â  messagingSenderId: "447237336190",
Â  appId: "1:447237336190:web:eab8a2b524b0dcdd5a3c2f",
Â  measurementId: "G-3DYLFJC5YH"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const candidatesList = [
Â  "Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø¯Ù‡","Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙ…Ø§Ù†Ù‰","Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯Ù‰","Ø¹Ø§Ø¯Ù„ Ø§Ù„Ø¬ÙŠØ§Ø±",
Â  "Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø³Ù…Ø±Ù‡","ÙˆÙ„ÙŠØ¯ ØªÙŠØ³ÙŠØ± Ø§Ù„Ø§Ù…ÙŠØ±","ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹ÙŠØ³ÙˆÙ‰","Ø§Ù„Ø¨Ø¯ÙˆÙ‰ Ø¬Ù…ÙŠØ²",
Â  "Ø§Ø­Ù…Ø¯ Ø§Ù„Ø±ÙŠØ³","Ø£Ø­Ù…Ø¯ Ø¹ÙˆÙ","Ø­Ø³Ù† Ø§Ù„Ù…Ù„Ù‡Ø§Ø·","Ø¹Ù…Ø±Ùˆ Ù…Ø­Ù…Ø¯ Ø¨Ø­ÙŠØ±Ù‰",
Â  "Ø§Ù„Ø³ÙŠØ¯ Ø·Ù…Ø§Ù†","Ù…Ø­Ù…Ø¯ Ø¯Ù†Ø¯Ù†","Ù…Ø¬Ø¯Ù‰ Ø§Ù„Ø£Ù…ÙŠØ±"
];
let allVotes = [];
let currentFilter = 'all';
let isAdmin = false;
let charts = { bar: null, line: null };
let currentEditId = null;
let tempPopupCommittee = null; // Ù„ØªØ®Ø²ÙŠÙ† Ø±Ù‚Ù… Ø§Ù„Ù„Ø¬Ù†Ø© Ø§Ù„Ù…ÙØªÙˆØ­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹

window.unlockSystem = function() {
Â  Â  const pass = document.getElementById('lock-pass').value;
Â  Â  const err = document.getElementById('login-error');
Â  Â  if(pass === 'aziza100') {
Â  Â  Â  Â  isAdmin = false; enterDashboard("Ù…Ø±Ø§Ù‚Ø¨");
Â  Â  } else if (pass === 'azizaadmin') {
Â  Â  Â  Â  isAdmin = true; enterDashboard("Ù…Ø¯ÙŠØ± Ø¹Ø§Ù…");
Â  Â  } else {
Â  Â  Â  Â  err.style.display = 'block';
Â  Â  }
}
function enterDashboard(role) {
Â  Â  document.getElementById('lock-screen').classList.add('hidden');
Â  Â  document.getElementById('dashboard').classList.remove('hidden');
Â  Â  document.getElementById('user-role').textContent = role;
Â  Â  if(isAdmin) {
Â  Â  Â  Â  document.getElementById('btn-reset').classList.remove('hidden');
Â  Â  Â  Â  document.querySelectorAll('.admin-col').forEach(el => el.classList.remove('hidden'));
Â  Â  }
Â  Â  startDataListener();
Â  Â  checkConnection();
}
function checkConnection() {
Â  Â  const connectedRef = ref(db, ".info/connected");
Â  Â  onValue(connectedRef, (snap) => {
Â  Â  Â  Â  const status = document.getElementById('conn-status');
Â  Â  Â  Â  const badge = status.parentElement;
Â  Â  Â  Â  if (snap.val() === true) {
Â  Â  Â  Â  Â  Â  status.textContent = "Ù…ØªØµÙ„";
Â  Â  Â  Â  Â  Â  badge.style.background = "#def7ec"; badge.style.color = "#03543f";
Â  Â  Â  Â  Â  Â  badge.querySelector('.dot').style.background = "#38ef7d";
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  status.textContent = "Ù…Ù†Ù‚Ø·Ø¹";
Â  Â  Â  Â  Â  Â  badge.style.background = "#feb2b2"; badge.style.color = "#742a2a";
Â  Â  Â  Â  Â  Â  badge.querySelector('.dot').style.background = "#e53e3e";
Â  Â  Â  Â  }
Â  Â  });
}
function startDataListener() {
Â  Â  const votesRef = ref(db, 'votes/aziza');
Â  Â  onValue(votesRef, (snapshot) => {
Â  Â  Â  Â  const data = snapshot.val();
Â  Â  Â  Â  allVotes = [];
Â  Â  Â  Â  if(data) {
Â  Â  Â  Â  Â  Â  Object.keys(data).forEach(key => {
Â  Â  Â  Â  Â  Â  Â  Â  allVotes.push({ id: key, ...data[key] });
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  }
Â  Â  Â  Â  allVotes.sort((a, b) => b.timestamp - a.timestamp);
Â  Â  Â  Â  updateUI();
Â  Â  });
    
    // **Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù„Ø¬Ø§Ù† ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙƒØ§Ù†**
    // const urgentMsgsRef = ref(db, 'urgent_msgs/global');
    // onValue(urgentMsgsRef, (snapshot) => {
    //    // ... Ù‚Ù… Ø¨Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù‡Ù†Ø§ ...
    // });
}
function updateUI() {
Â  Â  updateStats(); updateCharts(); updateRanking(); updateCommitteeBoxes();
Â  Â  renderTable();
Â  Â  if(!document.getElementById('details-popup').classList.contains('hidden') && tempPopupCommittee) {
Â  Â  Â  Â  window.showCommitteeDetails(tempPopupCommittee);
Â  Â  }
}
function updateStats() {
Â  Â  const total = allVotes.length;
Â  Â  const valid = allVotes.filter(v => v.vote_validity === "ØµØ­ÙŠØ­").length;
Â  Â  const invalid = allVotes.filter(v => v.vote_validity === "Ø¨Ø§Ø·Ù„").length;
Â  Â  const oneHourAgo = Date.now() - (60 * 60 * 1000);
Â  Â  const lastHourCount = allVotes.filter(v => v.timestamp > oneHourAgo).length;
Â  Â  let avgPerMin = 0;
Â  Â  if (total > 0) {
Â  Â  Â  Â  const firstVoteTime = allVotes[allVotes.length - 1].timestamp;
Â  Â  Â  Â  const durationMinutes = (Date.now() - firstVoteTime) / 60000;
Â  Â  Â  Â  if (durationMinutes > 0) {
Â  Â  Â  Â  Â  Â  avgPerMin = (total / durationMinutes).toFixed(2);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â avgPerMin = total;
Â  Â  Â  Â  }
Â  Â  }
Â  Â  document.getElementById('total-votes').textContent = total;
Â  Â  document.getElementById('valid-votes').textContent = valid;
Â  Â  document.getElementById('invalid-votes').textContent = invalid;
Â  Â  document.getElementById('last-hour-votes').textContent = lastHourCount;
Â  Â  document.getElementById('avg-per-min').textContent = avgPerMin;
Â  Â  document.getElementById('valid-percent').textContent = total ? Math.round((valid/total)*100)+"%" : "0%";
Â  Â  document.getElementById('invalid-percent').textContent = total ? Math.round((invalid/total)*100)+"%" : "0%";
}
function updateCommitteeBoxes() {
Â  Â  const c24 = allVotes.filter(v => v.committee == 24);
Â  Â  const c25 = allVotes.filter(v => v.committee == 25);
Â  Â  document.getElementById('comm-24-stats').textContent = `${c24.length} ØµÙˆØª (${c24.filter(v=>v.vote_validity=='ØµØ­ÙŠØ­').length} ØµØ­ÙŠØ­)`;
Â  Â  document.getElementById('comm-25-stats').textContent = `${c25.length} ØµÙˆØª (${c25.filter(v=>v.vote_validity=='ØµØ­ÙŠØ­').length} ØµØ­ÙŠØ­)`;
}
window.showCommitteeDetails = function(commId) {
Â  Â  tempPopupCommittee = commId;
Â  Â  const votes = allVotes.filter(v => v.committee == commId);
Â  Â  const total = votes.length;
Â  Â  const valid = votes.filter(v => v.vote_validity === 'ØµØ­ÙŠØ­').length;
Â  Â  const invalid = votes.filter(v => v.vote_validity === 'Ø¨Ø§Ø·Ù„').length;
Â  Â  let avgHour = 0, avgMin = 0, isActive = false;
Â  Â  if(total > 0) {
Â  Â  Â  Â  const firstVoteTime = votes[votes.length - 1].timestamp;
Â  Â  Â  Â  const lastVoteTime = votes[0].timestamp;
Â  Â  Â  Â  const durationMs = Date.now() - firstVoteTime;
Â  Â  Â  Â  const hours = durationMs / (1000 * 60 * 60);
Â  Â  Â  Â  const minutes = durationMs / (1000 * 60);
Â  Â  Â  Â  avgHour = hours > 0 ? (total / hours).toFixed(1) : total;
Â  Â  Â  Â  avgMin = minutes > 0 ? (total / minutes).toFixed(2) : total;
Â  Â  Â  Â  if(Date.now() - lastVoteTime < (60 * 60 * 1000)) { isActive = true;}
Â  Â  }
Â  Â  document.getElementById('dt-title').textContent = commId == 24 ? "ØªÙØ§ØµÙŠÙ„ Ù„Ø¬Ù†Ø© 24 (Ø±Ø¬Ø§Ù„)" : "ØªÙØ§ØµÙŠÙ„ Ù„Ø¬Ù†Ø© 25 (Ù†Ø³Ø§Ø¡)";
Â  Â  document.getElementById('dt-total').textContent = total;
Â  Â  document.getElementById('dt-valid').textContent = valid;
Â  Â  document.getElementById('dt-invalid').textContent = invalid;
Â  Â  document.getElementById('dt-avg-hour').textContent = avgHour;
Â  Â  document.getElementById('dt-avg-min').textContent = avgMin;
Â  Â  const statusEl = document.getElementById('dt-status');
Â  Â  if(isActive) {
Â  Â  Â  Â  statusEl.className = "status-indicator is-active";
Â  Â  Â  Â  statusEl.textContent = "ğŸŸ¢ Ø§Ù„Ù„Ø¬Ù†Ø© Ù†Ø´Ø·Ø© (Ø§Ø³ØªÙ‚Ø¨Ù„Øª Ø£ØµÙˆØ§Øª ÙÙŠ Ø¢Ø®Ø± Ø³Ø§Ø¹Ø©)";
Â  Â  } else {
Â  Â  Â  Â  statusEl.className = "status-indicator is-inactive";
Â  Â  Â  Â  statusEl.textContent = "ğŸ”´ Ø§Ù„Ù„Ø¬Ù†Ø© ØºÙŠØ± Ù†Ø´Ø·Ø© (Ù„Ù… ØªØ³ØªÙ‚Ø¨Ù„ Ø£ØµÙˆØ§Øª Ù…Ù†Ø° Ø³Ø§Ø¹Ø©)";
Â  Â  }
Â  Â  document.getElementById('details-popup').classList.remove('hidden');
}
window.filterTableFromPopup = function() {
Â  Â  if(tempPopupCommittee) {
Â  Â  Â  Â  filterTableByCommittee(tempPopupCommittee);
Â  Â  Â  Â  closePopup('details-popup');
Â  Â  }
}
function updateRanking() {
Â  Â  const container = document.getElementById('ranking-container');
Â  Â  const counts = {};
Â  Â  candidatesList.forEach(c => counts[c] = 0);
Â  Â  allVotes.forEach(v => {
Â  Â  Â  Â  if(v.selected && Array.isArray(v.selected)) {
Â  Â  Â  Â  Â  Â  v.selected.forEach(cand => {if(counts[cand] !== undefined) counts[cand]++;});
Â  Â  Â  Â  }
Â  Â  });
Â  Â  const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
Â  Â  const maxVal = sorted[0] ? sorted[0][1] : 1;
Â  Â  let html = '';
Â  Â  sorted.forEach(([name, count], index) => {
Â  Â  Â  Â  const percent = maxVal > 0 ? (count / maxVal) * 100 : 0;
Â  Â  Â  Â  const medal = index === 0 ? 'ğŸ¥‡' : (index === 1 ? 'ğŸ¥ˆ' : (index === 2 ? 'ğŸ¥‰' : `#${index+1}`));
Â  Â  Â  Â  html += `<div class="ranking-item">
Â  Â  Â  Â  Â  Â  <div style="width:40px;font-weight:bold;color:#718096;">${medal}</div>
Â  Â  Â  Â  Â  Â  <div style="width:140px;font-weight:bold;font-size:0.85rem;">${name}</div>
Â  Â  Â  Â  Â  Â  <div class="rank-bar-bg"><div class="rank-bar-fill" style="width:${percent}%"></div></div>
Â  Â  Â  Â  Â  Â  <div style="width:40px;text-align:left;font-weight:bold;">${count}</div>
Â  Â  Â  Â  </div>`;
Â  Â  });
Â  Â  container.innerHTML = html;
}
window.filterTableByCommittee = function(c) {
Â  Â  currentFilter = c;
Â  Â  renderTable();
Â  Â  showToast(c === 'all' ? "Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„" : `ØªÙ… Ø§Ù„ØªØµÙÙŠØ©: Ù„Ø¬Ù†Ø© ${c}`);
}
window.renderTable = function() {
Â  Â  const tbody = document.getElementById('table-body');
Â  Â  const search = document.getElementById('search-inp').value.toLowerCase();
Â  Â  let filtered = allVotes;
Â  Â  if(currentFilter !== 'all') filtered = filtered.filter(v => v.committee == currentFilter);
Â  Â  if(search) {
Â  Â  Â  Â  filtered = filtered.filter(v =>Â 
Â  Â  Â  Â  Â  Â  (v.name && v.name.toLowerCase().includes(search)) ||
Â  Â  Â  Â  Â  Â  (v.selected && v.selected.join(" ").includes(search))
Â  Â  Â  Â  );
Â  Â  }
Â  Â  let html = '';
Â  Â  filtered.forEach((v, i) => {
Â  Â  Â  Â  const statusClass = v.vote_validity === 'ØµØ­ÙŠØ­' ? 'status-ok' : 'status-bad';
Â  Â  Â  Â  const time = new Date(v.timestamp).toLocaleTimeString('ar-EG');
Â  Â  Â  Â  const cands = Array.isArray(v.selected) ? v.selected.join(" ØŒ ") : "";
Â  Â  Â  Â  const adminBtn = isAdmin ? `<button class="btn-action btn-blue" style="padding:5px 10px;font-size:0.7rem;" onclick="openEdit('${v.id}')">ØªØ¹Ø¯ÙŠÙ„</button>` : '';
Â  Â  Â  Â  html += `<tr>
Â  Â  Â  Â  Â  Â  <td>${filtered.length - i}</td>
Â  Â  Â  Â  Â  Â  <td style="font-weight:bold;">${v.name || "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…"}</td>
Â  Â  Â  Â  Â  Â  <td>${v.committee}</td>
Â  Â  Â  Â  Â  Â  <td style="font-size:0.85rem;color:#4a5568;">${cands}</td>
Â  Â  Â  Â  Â  Â  <td><span class="${statusClass}">${v.vote_validity}</span></td>
Â  Â  Â  Â  Â  Â  <td style="direction:ltr;">${time}</td>
Â  Â  Â  Â  Â  Â  <td class="${isAdmin ? '' : 'hidden'}">${adminBtn}</td>
Â  Â  Â  Â  </tr>`;
Â  Â  });
Â  Â  tbody.innerHTML = html || '<tr><td colspan="7" style="text-align:center; padding:20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td></tr>';
}
window.openEdit = function(id) {
Â  Â  const vote = allVotes.find(v => v.id === id);
Â  Â  if(!vote) return;
Â  Â  currentEditId = id;
Â  Â  document.getElementById('edit-voter-name').textContent = `Ø§Ù„Ù†Ø§Ø®Ø¨: ${vote.name}`;
Â  Â  document.getElementById('edit-popup').classList.remove('hidden');
Â  Â  const container = document.getElementById('edit-options-list');
Â  Â  let html = '';
Â  Â  candidatesList.forEach(cand => {
Â  Â  Â  Â  const checked = vote.selected && vote.selected.includes(cand) ? 'checked' : '';
Â  Â  Â  Â  html += `<label class="edit-option"><span>${cand}</span>
Â  Â  Â  Â  Â  Â  <input type="checkbox" value="${cand}" ${checked}></label>`;
Â  Â  });
Â  Â  container.innerHTML = html;
}
window.saveEditVote = function() {
Â  Â  if(!currentEditId) return;
Â  Â  const checked = Array.from(document.querySelectorAll('#edit-options-list input:checked')).map(i => i.value);
Â  Â  if(checked.length > 2) { showToast("Ø®Ø·Ø£: Ø§Ø®ØªØ± Ù…Ø±Ø´Ø­ÙŠÙ† ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰"); return; }
Â  Â  update(ref(db, `votes/aziza/${currentEditId}`), {selected: checked})
Â  Â  .then(() => {showToast("ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª Ø¨Ù†Ø¬Ø§Ø­"); closePopup('edit-popup');});
}
window.deleteSingleVote = function() {
Â  Â  if(!currentEditId || !confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙˆØª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) return;
Â  Â  remove(ref(db, `votes/aziza/${currentEditId}`)).then(() => {
Â  Â  Â  Â  showToast("ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙˆØª"); closePopup('edit-popup');
Â  Â  });
}
window.resetAllData = function() {
Â  Â  if(!confirm("ØªØ­Ø°ÙŠØ± Ø®Ø·ÙŠØ±!\nØ³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;
Â  Â  remove(ref(db, 'votes/aziza')).then(() => showToast("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„"));
}
window.sendNotify = function() {
Â  Â  const msg = document.getElementById('notify-msg').value.trim();
Â  Â  const target = document.querySelector('input[name="n-target"]:checked').value;
Â  Â  if(!msg) return showToast("Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹");
Â  Â  let branches = [];
Â  Â  if(target === "both") branches = ["24","25"]; else branches = [target];
Â  Â  Promise.all(
Â  Â  Â  branches.map(br => {
Â  Â  Â  Â  const notifRef = push(ref(db, `notifications/committee_${br}`));
Â  Â  Â  Â  return set(notifRef, {
Â  Â  Â  Â  Â  Â  message: msg,
Â  Â  Â  Â  Â  Â  timestamp: Date.now(),
Â  Â  Â  Â  Â  Â  sender: isAdmin ? "Ù…Ø¯ÙŠØ± Ø§Ù„ÙƒÙ†ØªØ±ÙˆÙ„" : "Ù…Ø±Ø§Ù‚Ø¨"
Â  Â  Â  Â  });
Â  Â  Â  })
Â  Â  ).then(() => {
Â  Â  Â  Â  showToast(`ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ø¬Ù†Ø© ${branches.length === 2 ? "24 Ùˆ 25" : branches[0]}`);
Â  Â  Â  Â  document.getElementById('notify-msg').value = '';
Â  Â  });
}
window.closePopup = function(id) {Â 
Â  Â  document.getElementById(id).classList.add('hidden');Â 
Â  Â  if(id === 'details-popup') tempPopupCommittee = null;
}
window.showToast = function(msg) {
Â  Â  const t = document.getElementById('toast');
Â  Â  t.textContent = msg; t.style.display = 'block';
Â  Â  setTimeout(() => t.style.display = 'none', 3000);
}
window.exportExcel = function() {
Â  Â  let csv = '\uFEFFID,Ø§Ù„Ø§Ø³Ù…,Ø§Ù„Ù„Ø¬Ù†Ø©,Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†,Ø§Ù„Ø­Ø§Ù„Ø©,Ø§Ù„ÙˆÙ‚Øª\n';Â 
Â  Â  allVotes.forEach((v, i) => {
Â  Â  Â  Â  const cands = v.selected ? `"${v.selected.join(" | ")}"` : "";
Â  Â  Â  Â  const time = new Date(v.timestamp).toLocaleString();
Â  Â  Â  Â  csv += `${i+1},"${v.name}",${v.committee},${cands},${v.vote_validity},"${time}"\n`;
Â  Â  });
Â  Â  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
Â  Â  const link = document.createElement("a");
Â  Â  link.href = URL.createObjectURL(blob);
Â  Â  link.download = "aziza_votes_report.csv";
Â  Â  link.click();
}
function updateCharts() {
Â  Â  const counts = candidatesList.map(c => {
Â  Â  Â  Â  return allVotes.reduce((acc, v) => (v.selected && v.selected.includes(c)) ? acc + 1 : acc, 0);
Â  Â  });
Â  Â  const ctxBar = document.getElementById('barChart').getContext('2d');
Â  Â  if(charts.bar) charts.bar.destroy();
Â  Â  charts.bar = new Chart(ctxBar, {
Â  Â  Â  Â  type: 'bar',
Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  labels: candidatesList,
Â  Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  Â  Â  label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙˆØ§Øª',
Â  Â  Â  Â  Â  Â  Â  Â  data: counts,
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: '#11998e',
Â  Â  Â  Â  Â  Â  Â  Â  borderRadius: 4
Â  Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  },
Â  Â  Â  Â  options: { responsive: true, maintainAspectRatio:false }
Â  Â  });
Â  Â  const timeData = {};
Â  Â  allVotes.forEach(v => {
Â  Â  Â  Â  const timeKey = new Date(v.timestamp).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
Â  Â  Â  Â  timeData[timeKey] = (timeData[timeKey] || 0) + 1;
Â  Â  });
Â  Â  const keys = Object.keys(timeData).reverse().slice(0, 20).reverse();
Â  Â  const values = keys.map(k => timeData[k]);
Â  Â  const ctxLine = document.getElementById('lineChart').getContext('2d');
Â  Â  if(charts.line) charts.line.destroy();
Â  Â  charts.line = new Chart(ctxLine, {
Â  Â  Â  Â  type: 'line',
Â  Â  Â  Â  data: {
Â  Â  Â  Â  Â  Â  labels: keys,
Â  Â  Â  Â  Â  Â  datasets: [{
Â  Â  Â  Â  Â  Â  Â  Â  label: 'Ù†Ø´Ø§Ø· Ø§Ù„ØªØµÙˆÙŠØª',
Â  Â  Â  Â  Â  Â  Â  Â  data: values,
Â  Â  Â  Â  Â  Â  Â  Â  borderColor: '#38ef7d',
Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor:'rgba(56,239,125,0.18)',
Â  Â  Â  Â  Â  Â  Â  Â  fill: true,
Â  Â  Â  Â  Â  Â  Â  Â  tension: 0.4
Â  Â  Â  Â  Â  Â  }]
Â  Â  Â  Â  },
Â  Â  Â  Â  options: { responsive: true, maintainAspectRatio:false }
Â  Â  });
}
</script>
</body>
</html>
